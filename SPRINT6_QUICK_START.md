# Sprint 6: æ´»åŠ¨ä¸è¥é”€ç³»ç»Ÿ - å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å¯åŠ¨åç«¯æœåŠ¡
```bash
cd /Users/like/CCTHub/backend/user-service
mvn spring-boot:run
```

### 2. å¯åŠ¨å‰ç«¯ç®¡ç†ç«¯
```bash
cd /Users/like/CCTHub/frontend/admin-web
npm run dev
```

### 3. è®¿é—®ç³»ç»Ÿ
- ç®¡ç†ç«¯: http://localhost:5173
- æ´»åŠ¨ç®¡ç†: http://localhost:5173/activities/list
- ç§’æ€ç®¡ç†: http://localhost:5173/seckills/list

---

## ğŸ“‹ åŠŸèƒ½æµ‹è¯•æ¸…å•

### æ´»åŠ¨ç®¡ç†æµ‹è¯•

**1. åˆ›å»ºæ´»åŠ¨**
- [ ] ç‚¹å‡»"åˆ›å»ºæ´»åŠ¨"æŒ‰é’®
- [ ] å¡«å†™æ´»åŠ¨ä¿¡æ¯:
  - æ´»åŠ¨åç§°: "é•¿æ²»å¤ªè¡Œå±±æ‰“å¡æ´»åŠ¨"
  - æ´»åŠ¨ç±»å‹: æ‰“å¡ä»»åŠ¡
  - å¼€å§‹æ—¶é—´: 2025-12-20 08:00:00
  - ç»“æŸæ—¶é—´: 2025-12-30 20:00:00
  - å¥–åŠ±é…ç½®: `{"type":"points","value":100}`
- [ ] ç‚¹å‡»"ç¡®å®š"åˆ›å»º
- [ ] æ£€æŸ¥åˆ—è¡¨ä¸­æ˜¯å¦å‡ºç°æ–°æ´»åŠ¨

**2. å®¡æ ¸æ´»åŠ¨**
- [ ] æ‰¾åˆ°"å¾…å®¡æ ¸"çŠ¶æ€çš„æ´»åŠ¨
- [ ] ç‚¹å‡»"é€šè¿‡"æŒ‰é’®
- [ ] æ£€æŸ¥å®¡æ ¸çŠ¶æ€å˜ä¸º"å®¡æ ¸é€šè¿‡"

**3. ä¸Šçº¿æ´»åŠ¨**
- [ ] æ‰¾åˆ°"å®¡æ ¸é€šè¿‡"ä¸”"æœªå¼€å§‹"çš„æ´»åŠ¨
- [ ] ç‚¹å‡»"ä¸Šçº¿"æŒ‰é’®
- [ ] æ£€æŸ¥æ´»åŠ¨çŠ¶æ€å˜ä¸º"è¿›è¡Œä¸­"

**4. æœç´¢ç­›é€‰**
- [ ] åœ¨"æ´»åŠ¨åç§°"æ¡†è¾“å…¥å…³é”®å­—
- [ ] é€‰æ‹©æ´»åŠ¨ç±»å‹ = "æ‰“å¡ä»»åŠ¡"
- [ ] é€‰æ‹©å®¡æ ¸çŠ¶æ€ = "å®¡æ ¸é€šè¿‡"
- [ ] ç‚¹å‡»"æŸ¥è¯¢"
- [ ] æ£€æŸ¥åˆ—è¡¨åªæ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„æ´»åŠ¨

**5. ç¼–è¾‘æ´»åŠ¨**
- [ ] ç‚¹å‡»æŸä¸ªæ´»åŠ¨çš„"ç¼–è¾‘"æŒ‰é’®
- [ ] ä¿®æ”¹æ´»åŠ¨æè¿°
- [ ] ç‚¹å‡»"ç¡®å®š"
- [ ] æ£€æŸ¥æ´»åŠ¨ä¿¡æ¯å·²æ›´æ–°

**6. ä¸‹çº¿æ´»åŠ¨**
- [ ] æ‰¾åˆ°"è¿›è¡Œä¸­"çš„æ´»åŠ¨
- [ ] ç‚¹å‡»"ä¸‹çº¿"æŒ‰é’®
- [ ] æ£€æŸ¥çŠ¶æ€å˜ä¸º"å·²ç»“æŸ"

**7. åˆ é™¤æ´»åŠ¨**
- [ ] æ‰¾åˆ°"å·²ç»“æŸ"æˆ–"æœªå¼€å§‹"çš„æ´»åŠ¨
- [ ] ç‚¹å‡»"åˆ é™¤"æŒ‰é’®
- [ ] ç¡®è®¤åˆ é™¤
- [ ] æ£€æŸ¥æ´»åŠ¨å·²ä»åˆ—è¡¨ç§»é™¤

---

### ç§’æ€ç®¡ç†æµ‹è¯•

**1. åˆ›å»ºç§’æ€**
- [ ] ç‚¹å‡»"åˆ›å»ºç§’æ€"æŒ‰é’®
- [ ] å¡«å†™ç§’æ€ä¿¡æ¯:
  - ç§’æ€æ ‡é¢˜: "æ™¯åŒºé—¨ç¥¨é™æ—¶ç§’æ€"
  - å•†å“ID: 1
  - ç§’æ€ä»·: 29.90
  - åŸä»·: 99.00
  - æ€»åº“å­˜: 100
  - æ¯äººé™è´­: 2
  - å¼€å§‹æ—¶é—´: 2025-12-20 10:00:00
  - ç»“æŸæ—¶é—´: 2025-12-20 12:00:00
- [ ] ç‚¹å‡»"ç¡®å®š"åˆ›å»º
- [ ] æ£€æŸ¥åˆ—è¡¨ä¸­æ˜¯å¦å‡ºç°æ–°ç§’æ€

**2. å¼€å§‹ç§’æ€**
- [ ] æ‰¾åˆ°"æœªå¼€å§‹"çš„ç§’æ€
- [ ] ç‚¹å‡»"å¼€å§‹"æŒ‰é’®
- [ ] æ£€æŸ¥çŠ¶æ€å˜ä¸º"è¿›è¡Œä¸­"

**3. ç¼–è¾‘ç§’æ€**
- [ ] ç‚¹å‡»æŸä¸ªç§’æ€çš„"ç¼–è¾‘"æŒ‰é’®
- [ ] ä¿®æ”¹æ€»åº“å­˜ä¸º200
- [ ] ç‚¹å‡»"ç¡®å®š"
- [ ] æ£€æŸ¥åº“å­˜å·²æ›´æ–°

**4. ç»“æŸç§’æ€**
- [ ] æ‰¾åˆ°"è¿›è¡Œä¸­"çš„ç§’æ€
- [ ] ç‚¹å‡»"ç»“æŸ"æŒ‰é’®
- [ ] æ£€æŸ¥çŠ¶æ€å˜ä¸º"å·²ç»“æŸ"

**5. åˆ é™¤ç§’æ€**
- [ ] æ‰¾åˆ°"å·²ç»“æŸ"çš„ç§’æ€
- [ ] ç‚¹å‡»"åˆ é™¤"æŒ‰é’®
- [ ] ç¡®è®¤åˆ é™¤
- [ ] æ£€æŸ¥ç§’æ€å·²ä»åˆ—è¡¨ç§»é™¤

---

## ğŸ§ª APIæµ‹è¯• (ä½¿ç”¨curl)

### æ´»åŠ¨APIæµ‹è¯•

**1. åˆ›å»ºæ´»åŠ¨**
```bash
curl -X POST http://localhost:8080/api/activities \
  -H "Content-Type: application/json" \
  -d '{
    "merchantId": 1,
    "name": "é•¿æ²»å¤ªè¡Œå±±æ‰“å¡æ´»åŠ¨",
    "type": 1,
    "description": "å®Œæˆ3ä¸ªæ‰“å¡ç‚¹å³å¯è·å¾—100ç§¯åˆ†",
    "startsAt": "2025-12-20 08:00:00",
    "endsAt": "2025-12-30 20:00:00",
    "location": "é•¿æ²»å¸‚å¤ªè¡Œå±±æ™¯åŒº",
    "participationLimit": 1000,
    "requirementType": 1,
    "rewardConfig": "{\"type\":\"points\",\"value\":100}"
  }'
```

**2. æŸ¥è¯¢æ´»åŠ¨åˆ—è¡¨**
```bash
curl -X GET "http://localhost:8080/api/activities?page=0&size=10"
```

**3. å®¡æ ¸æ´»åŠ¨**
```bash
curl -X PUT "http://localhost:8080/api/activities/1/audit?auditStatus=1"
```

**4. ä¸Šçº¿æ´»åŠ¨**
```bash
curl -X PUT "http://localhost:8080/api/activities/1/status?status=1"
```

**5. æŸ¥è¯¢è¿›è¡Œä¸­çš„æ´»åŠ¨**
```bash
curl -X GET "http://localhost:8080/api/activities/ongoing"
```

---

### å‚ä¸APIæµ‹è¯•

**1. å‚ä¸æ´»åŠ¨**
```bash
curl -X POST "http://localhost:8080/api/participations?activityId=1&userId=1"
```

**2. æ›´æ–°æ‰“å¡è¿›åº¦**
```bash
curl -X PUT "http://localhost:8080/api/participations/1/progress?checkpointId=checkpoint1"
```

**3. å®Œæˆæ´»åŠ¨**
```bash
curl -X PUT "http://localhost:8080/api/participations/1/complete"
```

**4. å‘æ”¾å¥–åŠ±**
```bash
curl -X POST "http://localhost:8080/api/participations/1/grant-reward"
```

**5. æŸ¥è¯¢ç”¨æˆ·å‚ä¸è®°å½•**
```bash
curl -X GET "http://localhost:8080/api/participations/user/1?page=0&size=10"
```

---

### ç§’æ€APIæµ‹è¯•

**1. åˆ›å»ºç§’æ€**
```bash
curl -X POST http://localhost:8080/api/seckills \
  -H "Content-Type: application/json" \
  -d '{
    "productId": 1,
    "title": "æ™¯åŒºé—¨ç¥¨é™æ—¶ç§’æ€",
    "seckillPrice": 29.90,
    "originalPrice": 99.00,
    "totalInventory": 100,
    "limitPerUser": 2,
    "startsAt": "2025-12-20 10:00:00",
    "endsAt": "2025-12-20 12:00:00"
  }'
```

**2. æŸ¥è¯¢ç§’æ€åˆ—è¡¨**
```bash
curl -X GET "http://localhost:8080/api/seckills?page=0&size=10"
```

**3. å¼€å§‹ç§’æ€**
```bash
curl -X PUT "http://localhost:8080/api/seckills/1/status?status=1"
```

**4. å¤„ç†ç§’æ€è´­ä¹°**
```bash
curl -X POST "http://localhost:8080/api/seckills/1/purchase?userId=1&quantity=1"
```

**5. æŸ¥è¯¢è¿›è¡Œä¸­çš„ç§’æ€**
```bash
curl -X GET "http://localhost:8080/api/seckills/ongoing"
```

---

## ğŸ” å¸¸è§é—®é¢˜

### 1. åç«¯å¯åŠ¨å¤±è´¥
**é—®é¢˜**: ç«¯å£8080å·²è¢«å ç”¨  
**è§£å†³**: ä¿®æ”¹`application.yml`ä¸­çš„`server.port`

**é—®é¢˜**: æ•°æ®åº“è¿æ¥å¤±è´¥  
**è§£å†³**: æ£€æŸ¥`application.yml`ä¸­çš„æ•°æ®åº“é…ç½®ï¼Œç¡®ä¿MySQLå·²å¯åŠ¨

### 2. å‰ç«¯å¯åŠ¨å¤±è´¥
**é—®é¢˜**: ç«¯å£5173å·²è¢«å ç”¨  
**è§£å†³**: ä¿®æ”¹`vite.config.js`ä¸­çš„`server.port`

**é—®é¢˜**: npm installå¤±è´¥  
**è§£å†³**: åˆ é™¤`node_modules`å’Œ`package-lock.json`ï¼Œé‡æ–°æ‰§è¡Œ`npm install`

### 3. åˆ›å»ºæ´»åŠ¨å¤±è´¥
**é—®é¢˜**: å¥–åŠ±é…ç½®JSONæ ¼å¼é”™è¯¯  
**è§£å†³**: ç¡®ä¿rewardConfigä¸ºæœ‰æ•ˆJSONï¼Œå¦‚`{"type":"points","value":100}`

**é—®é¢˜**: æ—¶é—´æ ¼å¼é”™è¯¯  
**è§£å†³**: ä½¿ç”¨æ ¼å¼`YYYY-MM-DD HH:mm:ss`ï¼Œå¦‚`2025-12-20 08:00:00`

### 4. å‚ä¸æ´»åŠ¨å¤±è´¥
**é—®é¢˜**: ç”¨æˆ·ç­‰çº§ä¸è¶³  
**è§£å†³**: æ£€æŸ¥æ´»åŠ¨çš„requirementTypeå’ŒrequirementValueï¼Œç¡®ä¿ç”¨æˆ·æ»¡è¶³æ¡ä»¶

**é—®é¢˜**: æ´»åŠ¨æœªå¼€å§‹  
**è§£å†³**: æ£€æŸ¥æ´»åŠ¨çŠ¶æ€æ˜¯å¦ä¸º"è¿›è¡Œä¸­"ï¼Œå®¡æ ¸çŠ¶æ€æ˜¯å¦ä¸º"å®¡æ ¸é€šè¿‡"

### 5. ç§’æ€è´­ä¹°å¤±è´¥
**é—®é¢˜**: åº“å­˜ä¸è¶³  
**è§£å†³**: æ£€æŸ¥availableInventoryæ˜¯å¦å¤§äº0

**é—®é¢˜**: è¶…è¿‡é™è´­æ•°é‡  
**è§£å†³**: æ£€æŸ¥quantityæ˜¯å¦è¶…è¿‡limitPerUser

---

## ğŸ“Š æ•°æ®åº“æŸ¥è¯¢

### æŸ¥è¯¢æ´»åŠ¨æ•°æ®
```sql
-- æŸ¥è¯¢æ‰€æœ‰æ´»åŠ¨
SELECT * FROM activities ORDER BY created_at DESC;

-- æŸ¥è¯¢è¿›è¡Œä¸­çš„æ´»åŠ¨
SELECT * FROM activities 
WHERE status = 1 AND audit_status = 1
  AND starts_at <= NOW() AND ends_at >= NOW();

-- æŸ¥è¯¢æ´»åŠ¨ç»Ÿè®¡
SELECT 
  a.id, a.name, a.type,
  COUNT(p.id) as participant_count,
  SUM(CASE WHEN p.participation_status = 2 THEN 1 ELSE 0 END) as completed_count
FROM activities a
LEFT JOIN activity_participations p ON a.id = p.activity_id
GROUP BY a.id;
```

### æŸ¥è¯¢å‚ä¸è®°å½•
```sql
-- æŸ¥è¯¢æŸç”¨æˆ·çš„å‚ä¸è®°å½•
SELECT * FROM activity_participations 
WHERE user_id = 1 
ORDER BY joined_at DESC;

-- æŸ¥è¯¢æŸæ´»åŠ¨çš„å‚ä¸è®°å½•
SELECT 
  p.*, u.nickname, u.phone
FROM activity_participations p
LEFT JOIN users u ON p.user_id = u.id
WHERE p.activity_id = 1;

-- æŸ¥è¯¢å¾…å‘æ”¾å¥–åŠ±çš„è®°å½•
SELECT * FROM activity_participations
WHERE participation_status = 2 AND reward_status = 0;
```

### æŸ¥è¯¢ç§’æ€æ•°æ®
```sql
-- æŸ¥è¯¢æ‰€æœ‰ç§’æ€
SELECT * FROM seckill_events ORDER BY created_at DESC;

-- æŸ¥è¯¢è¿›è¡Œä¸­çš„ç§’æ€
SELECT * FROM seckill_events
WHERE status = 1 
  AND starts_at <= NOW() AND ends_at >= NOW()
  AND available_inventory > 0;

-- æŸ¥è¯¢ç§’æ€åº“å­˜æƒ…å†µ
SELECT 
  id, title, 
  total_inventory,
  available_inventory,
  (total_inventory - available_inventory) as sold_count,
  ROUND((total_inventory - available_inventory) * 100.0 / total_inventory, 2) as sold_percentage
FROM seckill_events;
```

---

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### æ•°æ®åº“æ…¢æŸ¥è¯¢
```sql
-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—
SHOW VARIABLES LIKE 'slow_query_log_file';
```

### æ´»åŠ¨å‚ä¸ç»Ÿè®¡
```sql
-- ç»Ÿè®¡æ¯æ—¥å‚ä¸äººæ•°
SELECT 
  DATE(joined_at) as date,
  COUNT(*) as participant_count
FROM activity_participations
GROUP BY DATE(joined_at)
ORDER BY date DESC;

-- ç»Ÿè®¡æ´»åŠ¨ç±»å‹åˆ†å¸ƒ
SELECT 
  type,
  COUNT(*) as activity_count
FROM activities
GROUP BY type;
```

### ç§’æ€åº“å­˜ç›‘æ§
```sql
-- ç›‘æ§åº“å­˜ç´§å¼ çš„ç§’æ€
SELECT 
  id, title, 
  available_inventory,
  total_inventory,
  ROUND(available_inventory * 100.0 / total_inventory, 2) as inventory_percentage
FROM seckill_events
WHERE status = 1 
  AND available_inventory < total_inventory * 0.2;
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### å³å°†å®ç°çš„åŠŸèƒ½
1. **ç”¨æˆ·ç«¯é¡µé¢** (ä¼˜å…ˆçº§: é«˜)
   - æ´»åŠ¨åˆ—è¡¨é¡µ
   - æ´»åŠ¨è¯¦æƒ…é¡µ
   - æ‰“å¡é¡µé¢
   - ç§’æ€é¡µé¢

2. **æ‰“å¡åŠŸèƒ½å¢å¼º** (ä¼˜å…ˆçº§: é«˜)
   - GPSæ‰“å¡éªŒè¯
   - æ‰«ç æ‰“å¡
   - æ‰“å¡ç…§ç‰‡ä¸Šä¼ 
   - æ‰“å¡æ’è¡Œæ¦œ

3. **ç§’æ€æ€§èƒ½ä¼˜åŒ–** (ä¼˜å…ˆçº§: ä¸­)
   - Redisé¢„æ‰£åº“å­˜
   - æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†è®¢å•
   - åˆ†å¸ƒå¼é”
   - é™æµæ§åˆ¶

4. **æ¨èç³»ç»Ÿ** (ä¼˜å…ˆçº§: ä¸­)
   - çƒ­é—¨æ™¯åŒºæ¨è
   - é™„è¿‘æ™¯åŒºæ¨è
   - çƒ­é—¨æ´»åŠ¨æ¨è
   - ä¸ªæ€§åŒ–æ¨è

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-16 21:10  
**ç»´æŠ¤äºº**: GitHub Copilot
