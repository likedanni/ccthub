import{r as S}from"./request-Bsn8Vm96.js";import{_ as Q,r as N,a as P,h as Z,c as ee,o as V,b as e,w as t,d,E as z,i as te,f as o,g as u,t as n,j as ae,k as D,l as Y,m as le}from"./index-D83cRL-0.js";function se(w){return S({url:`/payments/${w}/close`,method:"put"})}function oe(w){return S({url:"/payments",method:"get",params:w})}function ne(){return S({url:"/payments/statistics",method:"get"})}const de={class:"payment-management"},re={class:"stat-content"},ie={class:"stat-value"},ue={class:"stat-content"},pe={class:"stat-value"},ce={class:"stat-content"},me={class:"stat-value"},_e={class:"stat-content"},fe={class:"stat-value"},ye={__name:"PaymentList",setup(w){const x=N(!1),k=N([]),C=N(!1),i=N(null),r=P({orderNo:"",paymentType:"",status:null,timeRange:[]}),m=P({page:1,size:10,total:0}),v=P({pending:0,success:0,failed:0,processing:0}),g=async()=>{var s,a;x.value=!0;try{const b={page:m.page-1,size:m.size,orderNo:r.orderNo||void 0,paymentType:r.paymentType||void 0,status:r.status!==null?r.status:void 0,startTime:((s=r.timeRange)==null?void 0:s[0])||void 0,endTime:((a=r.timeRange)==null?void 0:a[1])||void 0},_=await oe(b);_.success&&_.data?(k.value=_.data.records||[],m.total=_.data.total||0):(k.value=[],m.total=0)}catch(b){z.error("加载数据失败："+b.message)}finally{x.value=!1}},A=async()=>{try{const s=await ne();Object.assign(v,s)}catch(s){console.error("加载统计数据失败",s)}},E=()=>{m.page=1,g()},B=()=>{Object.assign(r,{orderNo:"",paymentType:"",status:null,timeRange:[]}),E()},j=s=>{i.value=s,C.value=!0},H=async s=>{try{await le.confirm("确认关闭此支付订单？","提示",{type:"warning"}),await se(s.paymentNo),z.success("关闭成功"),g(),A()}catch(a){a!=="cancel"&&z.error("关闭失败："+a.message)}},I=s=>({0:"warning",1:"success",2:"danger",3:"info",4:"primary"})[s]||"",M=s=>({WECHAT:"微信支付",ALIPAY:"支付宝",POINTS:"积分支付",MIXED:"混合支付",wechat:"微信支付",alipay:"支付宝",points:"积分支付",mixed:"混合支付"})[s]||s,L=s=>({WECHAT:"微信",ALIPAY:"支付宝",POINTS:"系统",MIXED:"多渠道",wechat:"微信",alipay:"支付宝",points:"系统",mixed:"多渠道"})[s]||s;return Z(()=>{g(),A()}),(s,a)=>{const b=d("el-input"),_=d("el-form-item"),f=d("el-option"),R=d("el-select"),O=d("el-date-picker"),T=d("el-button"),$=d("el-form"),y=d("el-card"),h=d("el-col"),W=d("el-row"),p=d("el-table-column"),U=d("el-tag"),X=d("el-table"),q=d("el-pagination"),c=d("el-descriptions-item"),F=d("el-descriptions"),G=d("el-dialog"),J=te("loading");return V(),ee("div",de,[e(y,{class:"search-card"},{default:t(()=>[e($,{inline:!0,model:r,class:"search-form"},{default:t(()=>[e(_,{label:"订单号"},{default:t(()=>[e(b,{modelValue:r.orderNo,"onUpdate:modelValue":a[0]||(a[0]=l=>r.orderNo=l),placeholder:"请输入订单号",clearable:""},null,8,["modelValue"])]),_:1}),e(_,{label:"支付类型"},{default:t(()=>[e(R,{modelValue:r.paymentType,"onUpdate:modelValue":a[1]||(a[1]=l=>r.paymentType=l),placeholder:"请选择支付类型",clearable:"",style:{width:"150px"}},{default:t(()=>[e(f,{label:"微信支付",value:"wechat"}),e(f,{label:"支付宝",value:"alipay"}),e(f,{label:"余额支付",value:"balance"})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"状态"},{default:t(()=>[e(R,{modelValue:r.status,"onUpdate:modelValue":a[2]||(a[2]=l=>r.status=l),placeholder:"请选择状态",clearable:"",style:{width:"150px"}},{default:t(()=>[e(f,{label:"待支付",value:0}),e(f,{label:"支付成功",value:1}),e(f,{label:"支付失败",value:2}),e(f,{label:"已关闭",value:3}),e(f,{label:"处理中",value:4})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"时间范围"},{default:t(()=>[e(O,{modelValue:r.timeRange,"onUpdate:modelValue":a[3]||(a[3]=l=>r.timeRange=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(_,null,{default:t(()=>[e(T,{type:"primary",onClick:E},{default:t(()=>[...a[7]||(a[7]=[o("检索",-1)])]),_:1}),e(T,{onClick:B},{default:t(()=>[...a[8]||(a[8]=[o("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(W,{gutter:20,class:"stats-row"},{default:t(()=>[e(h,{span:6},{default:t(()=>[e(y,{class:"stat-card"},{default:t(()=>[u("div",re,[a[9]||(a[9]=u("div",{class:"stat-label"},"待支付",-1)),u("div",ie,n(v.pending||0),1)])]),_:1})]),_:1}),e(h,{span:6},{default:t(()=>[e(y,{class:"stat-card success"},{default:t(()=>[u("div",ue,[a[10]||(a[10]=u("div",{class:"stat-label"},"支付成功",-1)),u("div",pe,n(v.success||0),1)])]),_:1})]),_:1}),e(h,{span:6},{default:t(()=>[e(y,{class:"stat-card danger"},{default:t(()=>[u("div",ce,[a[11]||(a[11]=u("div",{class:"stat-label"},"支付失败",-1)),u("div",me,n(v.failed||0),1)])]),_:1})]),_:1}),e(h,{span:6},{default:t(()=>[e(y,{class:"stat-card info"},{default:t(()=>[u("div",_e,[a[12]||(a[12]=u("div",{class:"stat-label"},"处理中",-1)),u("div",fe,n(v.processing||0),1)])]),_:1})]),_:1})]),_:1}),e(y,{class:"table-card"},{default:t(()=>[ae((V(),D(X,{data:k.value,border:"",stripe:""},{default:t(()=>[e(p,{prop:"paymentNo",label:"支付单号",width:"200"}),e(p,{prop:"orderNo",label:"订单号",width:"200"}),e(p,{prop:"paymentType",label:"支付类型",width:"120"},{default:t(({row:l})=>[o(n(M(l.paymentType)),1)]),_:1}),e(p,{prop:"paymentChannelText",label:"支付渠道",width:"100"}),e(p,{prop:"paymentAmount",label:"支付金额",width:"120"},{default:t(({row:l})=>[o(" ¥"+n(l.paymentAmount),1)]),_:1}),e(p,{prop:"statusText",label:"状态",width:"100"},{default:t(({row:l})=>[e(U,{type:I(l.status)},{default:t(()=>[o(n(l.statusText),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"payerName",label:"支付用户",width:"150","show-overflow-tooltip":""}),e(p,{prop:"thirdPartyNo",label:"第三方流水号",width:"200","show-overflow-tooltip":""}),e(p,{prop:"paymentTime",label:"支付时间",width:"180"}),e(p,{prop:"createTime",label:"创建时间",width:"180"}),e(p,{label:"操作",width:"150",fixed:"right"},{default:t(({row:l})=>[e(T,{link:"",type:"primary",size:"small",onClick:K=>j(l)},{default:t(()=>[...a[13]||(a[13]=[o("详情",-1)])]),_:1},8,["onClick"]),l.status===0?(V(),D(T,{key:0,link:"",type:"danger",size:"small",onClick:K=>H(l)},{default:t(()=>[...a[14]||(a[14]=[o(" 关闭 ",-1)])]),_:1},8,["onClick"])):Y("",!0)]),_:1})]),_:1},8,["data"])),[[J,x.value]]),e(q,{"current-page":m.page,"onUpdate:currentPage":a[4]||(a[4]=l=>m.page=l),"page-size":m.size,"onUpdate:pageSize":a[5]||(a[5]=l=>m.size=l),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:g,onCurrentChange:g,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e(G,{modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=l=>C.value=l),title:"支付详情",width:"800px"},{default:t(()=>[i.value?(V(),D(F,{key:0,column:2,border:""},{default:t(()=>[e(c,{label:"支付单号"},{default:t(()=>[o(n(i.value.paymentNo),1)]),_:1}),e(c,{label:"订单号"},{default:t(()=>[o(n(i.value.orderNo),1)]),_:1}),e(c,{label:"支付类型"},{default:t(()=>[o(n(M(i.value.paymentType)),1)]),_:1}),e(c,{label:"支付渠道"},{default:t(()=>[o(n(L(i.value.paymentType)),1)]),_:1}),e(c,{label:"支付金额"},{default:t(()=>[o("¥"+n(i.value.paymentAmount),1)]),_:1}),e(c,{label:"状态"},{default:t(()=>[e(U,{type:I(i.value.status)},{default:t(()=>[o(n(i.value.statusText),1)]),_:1},8,["type"])]),_:1}),e(c,{label:"支付用户"},{default:t(()=>[o(n(i.value.payerName||i.value.payerId||"-"),1)]),_:1}),e(c,{label:"第三方流水号"},{default:t(()=>[o(n(i.value.thirdPartyNo||"-"),1)]),_:1}),e(c,{label:"支付时间"},{default:t(()=>[o(n(i.value.paymentTime||"-"),1)]),_:1}),e(c,{label:"回调时间"},{default:t(()=>[o(n(i.value.callbackTime||"-"),1)]),_:1}),e(c,{label:"创建时间",span:2},{default:t(()=>[o(n(i.value.createTime),1)]),_:1})]),_:1})):Y("",!0)]),_:1},8,["modelValue"])])}}},be=Q(ye,[["__scopeId","data-v-87240698"]]);export{be as default};
