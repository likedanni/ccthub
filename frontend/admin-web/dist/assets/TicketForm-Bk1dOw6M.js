import{e as J}from"./scenic-Bwua_7dy.js";import{a as K,b as Q,c as W}from"./ticket-SmaOlMMv.js";import{_ as X,r as U,B as Y,C as Z,a as x,h as $,c as R,o as V,b as l,w as t,q as h,D as ee,d as i,E as v,u as le,i as te,g as f,t as B,j as ae,k as b,l as D,f as n,F as oe,n as de}from"./index-ch6PX-9l.js";import"./request-Ba914Fe9.js";const ne={class:"ticket-form"},ie={class:"page-title"},re={class:"refund-policy"},ue={class:"change-policy"},se={__name:"TicketForm",setup(me){const q=le(),_=Z(),T=U(null),g=Y(()=>!!_.params.id),c=U(!1),k=U(!1),S=U([]),o=x({scenicSpotId:null,name:"",type:1,description:"",validityType:1,validDays:null,advanceDays:0,refundPolicy:{},changePolicy:{},limitPerUser:null,limitPerOrder:null,limitPerDay:null,requireRealName:!1,requireIdCard:!1,verificationMode:1,status:1}),p=x({within_24h:.5,within_48h:.7,over_48h:1}),r=x({allowed:!0,fee:10,advance_hours:24}),O={scenicSpotId:[{required:!0,message:"请选择景区",trigger:"change"}],name:[{required:!0,message:"请输入票种名称",trigger:"blur"},{min:2,max:200,message:"长度在 2 到 200 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择票种类型",trigger:"change"}],validityType:[{required:!0,message:"请选择有效期类型",trigger:"change"}]},M=async()=>{try{const m=await J({size:1e3});S.value=m.content||[]}catch{v.error("加载景区列表失败")}},j=async()=>{if(_.params.id){c.value=!0;try{const m=await K(_.params.id);Object.assign(o,m),Object.assign(p,m.refundPolicy||{}),Object.assign(r,m.changePolicy||{})}catch{v.error("加载票种详情失败")}finally{c.value=!1}}},E=async()=>{await T.value.validate(),o.refundPolicy={...p},o.changePolicy={...r},k.value=!0;try{g.value?(await Q(_.params.id,o),v.success("保存成功")):(await W(o),v.success("创建成功")),q.push("/tickets/list")}catch{v.error(g.value?"保存失败":"创建失败")}finally{k.value=!1}},C=()=>{q.push("/tickets/list")};return $(()=>{M(),j()}),(m,e)=>{const F=i("el-page-header"),y=i("el-divider"),z=i("el-option"),L=i("el-select"),d=i("el-form-item"),I=i("el-input"),u=i("el-radio"),w=i("el-radio-group"),s=i("el-input-number"),P=i("el-switch"),N=i("el-button"),A=i("el-form"),G=i("el-card"),H=te("loading");return V(),R("div",ne,[l(F,{onBack:C,icon:h(ee)},{content:t(()=>[f("span",ie,B(g.value?"编辑票种":"创建票种"),1)]),_:1},8,["icon"]),l(G,{class:"form-card"},{default:t(()=>[ae((V(),b(A,{ref_key:"formRef",ref:T,model:o,rules:O,"label-width":"140px"},{default:t(()=>[l(y,{"content-position":"left"},{default:t(()=>[...e[20]||(e[20]=[n("基本信息",-1)])]),_:1}),l(d,{label:"所属景区",prop:"scenicSpotId"},{default:t(()=>[l(L,{modelValue:o.scenicSpotId,"onUpdate:modelValue":e[0]||(e[0]=a=>o.scenicSpotId=a),placeholder:"请选择景区",style:{width:"400px"}},{default:t(()=>[(V(!0),R(oe,null,de(S.value,a=>(V(),b(z,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"票种名称",prop:"name"},{default:t(()=>[l(I,{modelValue:o.name,"onUpdate:modelValue":e[1]||(e[1]=a=>o.name=a),placeholder:"请输入票种名称",style:{width:"400px"}},null,8,["modelValue"])]),_:1}),l(d,{label:"票种类型",prop:"type"},{default:t(()=>[l(w,{modelValue:o.type,"onUpdate:modelValue":e[2]||(e[2]=a=>o.type=a)},{default:t(()=>[l(u,{label:1},{default:t(()=>[...e[21]||(e[21]=[n("单票",-1)])]),_:1}),l(u,{label:2},{default:t(()=>[...e[22]||(e[22]=[n("联票",-1)])]),_:1}),l(u,{label:3},{default:t(()=>[...e[23]||(e[23]=[n("套票",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"票种描述",prop:"description"},{default:t(()=>[l(I,{modelValue:o.description,"onUpdate:modelValue":e[3]||(e[3]=a=>o.description=a),type:"textarea",rows:4,placeholder:"请输入票种描述",style:{width:"600px"}},null,8,["modelValue"])]),_:1}),l(y,{"content-position":"left"},{default:t(()=>[...e[24]||(e[24]=[n("有效期设置",-1)])]),_:1}),l(d,{label:"有效期类型",prop:"validityType"},{default:t(()=>[l(w,{modelValue:o.validityType,"onUpdate:modelValue":e[4]||(e[4]=a=>o.validityType=a)},{default:t(()=>[l(u,{label:1},{default:t(()=>[...e[25]||(e[25]=[n("指定日期（单日有效）",-1)])]),_:1}),l(u,{label:2},{default:t(()=>[...e[26]||(e[26]=[n("有效天数（多日有效）",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o.validityType===2?(V(),b(d,{key:0,label:"有效天数",prop:"validDays"},{default:t(()=>[l(s,{modelValue:o.validDays,"onUpdate:modelValue":e[5]||(e[5]=a=>o.validDays=a),min:1,max:365,placeholder:"请输入有效天数"},null,8,["modelValue"]),e[27]||(e[27]=f("span",{class:"tip"},"例如：购买后3天内有效",-1))]),_:1})):D("",!0),l(d,{label:"提前预订天数",prop:"advanceDays"},{default:t(()=>[l(s,{modelValue:o.advanceDays,"onUpdate:modelValue":e[6]||(e[6]=a=>o.advanceDays=a),min:0,max:365,placeholder:"请输入提前预订天数"},null,8,["modelValue"]),e[28]||(e[28]=f("span",{class:"tip"},"0表示可当天购买",-1))]),_:1}),l(y,{"content-position":"left"},{default:t(()=>[...e[29]||(e[29]=[n("退改签规则",-1)])]),_:1}),l(d,{label:"退款规则",required:""},{default:t(()=>[f("div",re,[l(d,{label:"24小时内退款率"},{default:t(()=>[l(s,{modelValue:p.within_24h,"onUpdate:modelValue":e[7]||(e[7]=a=>p.within_24h=a),min:0,max:1,step:.1,precision:1},null,8,["modelValue"]),e[30]||(e[30]=f("span",{class:"tip"},"0.5 = 退50%",-1))]),_:1}),l(d,{label:"48小时内退款率"},{default:t(()=>[l(s,{modelValue:p.within_48h,"onUpdate:modelValue":e[8]||(e[8]=a=>p.within_48h=a),min:0,max:1,step:.1,precision:1},null,8,["modelValue"]),e[31]||(e[31]=f("span",{class:"tip"},"0.7 = 退70%",-1))]),_:1}),l(d,{label:"48小时外退款率"},{default:t(()=>[l(s,{modelValue:p.over_48h,"onUpdate:modelValue":e[9]||(e[9]=a=>p.over_48h=a),min:0,max:1,step:.1,precision:1},null,8,["modelValue"]),e[32]||(e[32]=f("span",{class:"tip"},"1.0 = 全额退款",-1))]),_:1})])]),_:1}),l(d,{label:"改签规则",required:""},{default:t(()=>[f("div",ue,[l(d,{label:"是否允许改签"},{default:t(()=>[l(P,{modelValue:r.allowed,"onUpdate:modelValue":e[10]||(e[10]=a=>r.allowed=a)},null,8,["modelValue"])]),_:1}),r.allowed?(V(),b(d,{key:0,label:"改签手续费（元）"},{default:t(()=>[l(s,{modelValue:r.fee,"onUpdate:modelValue":e[11]||(e[11]=a=>r.fee=a),min:0,precision:2},null,8,["modelValue"])]),_:1})):D("",!0),r.allowed?(V(),b(d,{key:1,label:"提前改签时间（小时）"},{default:t(()=>[l(s,{modelValue:r.advance_hours,"onUpdate:modelValue":e[12]||(e[12]=a=>r.advance_hours=a),min:0},null,8,["modelValue"])]),_:1})):D("",!0)])]),_:1}),l(y,{"content-position":"left"},{default:t(()=>[...e[33]||(e[33]=[n("限购设置",-1)])]),_:1}),l(d,{label:"每用户限购数量",prop:"limitPerUser"},{default:t(()=>[l(s,{modelValue:o.limitPerUser,"onUpdate:modelValue":e[13]||(e[13]=a=>o.limitPerUser=a),min:1,placeholder:"不限制请留空"},null,8,["modelValue"])]),_:1}),l(d,{label:"每订单限购数量",prop:"limitPerOrder"},{default:t(()=>[l(s,{modelValue:o.limitPerOrder,"onUpdate:modelValue":e[14]||(e[14]=a=>o.limitPerOrder=a),min:1,placeholder:"不限制请留空"},null,8,["modelValue"])]),_:1}),l(d,{label:"每日限购数量",prop:"limitPerDay"},{default:t(()=>[l(s,{modelValue:o.limitPerDay,"onUpdate:modelValue":e[15]||(e[15]=a=>o.limitPerDay=a),min:1,placeholder:"不限制请留空"},null,8,["modelValue"])]),_:1}),l(y,{"content-position":"left"},{default:t(()=>[...e[34]||(e[34]=[n("实名与核验",-1)])]),_:1}),l(d,{label:"是否需要实名",prop:"requireRealName"},{default:t(()=>[l(P,{modelValue:o.requireRealName,"onUpdate:modelValue":e[16]||(e[16]=a=>o.requireRealName=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"是否需要身份证",prop:"requireIdCard"},{default:t(()=>[l(P,{modelValue:o.requireIdCard,"onUpdate:modelValue":e[17]||(e[17]=a=>o.requireIdCard=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"核验方式",prop:"verificationMode"},{default:t(()=>[l(w,{modelValue:o.verificationMode,"onUpdate:modelValue":e[18]||(e[18]=a=>o.verificationMode=a)},{default:t(()=>[l(u,{label:1},{default:t(()=>[...e[35]||(e[35]=[n("二维码",-1)])]),_:1}),l(u,{label:2},{default:t(()=>[...e[36]||(e[36]=[n("人脸识别",-1)])]),_:1}),l(u,{label:3},{default:t(()=>[...e[37]||(e[37]=[n("身份证",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(y,{"content-position":"left"},{default:t(()=>[...e[38]||(e[38]=[n("状态设置",-1)])]),_:1}),l(d,{label:"状态",prop:"status"},{default:t(()=>[l(w,{modelValue:o.status,"onUpdate:modelValue":e[19]||(e[19]=a=>o.status=a)},{default:t(()=>[l(u,{label:1},{default:t(()=>[...e[39]||(e[39]=[n("上架",-1)])]),_:1}),l(u,{label:0},{default:t(()=>[...e[40]||(e[40]=[n("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:t(()=>[l(N,{type:"primary",onClick:E,loading:k.value},{default:t(()=>[n(B(g.value?"保存":"创建"),1)]),_:1},8,["loading"]),l(N,{onClick:C},{default:t(()=>[...e[41]||(e[41]=[n("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])),[[H,c.value]])]),_:1})])}}},ve=X(se,[["__scopeId","data-v-a57fbd72"]]);export{ve as default};
