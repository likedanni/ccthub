import{r as V}from"./request-Bsn8Vm96.js";import{_ as L,a as z,r as w,h as G,E as g,c as J,o as f,b as l,w as a,d as r,f as n,k as b,l as D,m as K}from"./index-D83cRL-0.js";function Q(u){return V({url:"/seckills",method:"get",params:u})}function W(u){return V({url:"/seckills",method:"post",data:u})}function X(u,p){return V({url:`/seckills/${u}`,method:"put",data:p})}function Z(u){return V({url:`/seckills/${u}`,method:"delete"})}function ee(u,p){return V({url:`/seckills/${u}/status`,method:"put",params:{status:p}})}const le={class:"seckill-manage"},te={__name:"SeckillManage",setup(u){const p=z({status:null}),A=w([]),m=z({page:1,size:10,total:0}),k=w(!1),I=w("创建秒杀"),U=w(null),o=z({id:null,productId:null,title:"",seckillPrice:0,originalPrice:0,totalInventory:100,limitPerUser:1,startsAt:"",endsAt:""}),H={title:[{required:!0,message:"请输入秒杀标题",trigger:"blur"}],productId:[{required:!0,message:"请输入商品ID",trigger:"blur"}],seckillPrice:[{required:!0,message:"请输入秒杀价",trigger:"blur"}],originalPrice:[{required:!0,message:"请输入原价",trigger:"blur"}],totalInventory:[{required:!0,message:"请输入总库存",trigger:"blur"}],startsAt:[{required:!0,message:"请选择开始时间",trigger:"change"}],endsAt:[{required:!0,message:"请选择结束时间",trigger:"change"}]};G(()=>{y()});const y=async()=>{try{const s={...p,page:m.page-1,size:m.size},e=await Q(s);A.value=e.content,m.total=e.totalElements}catch{g.error("获取秒杀列表失败")}},P=()=>{m.page=1,y()},$=()=>{p.status=null,P()},B=()=>{I.value="创建秒杀",Object.assign(o,{id:null,productId:null,title:"",seckillPrice:0,originalPrice:0,totalInventory:100,limitPerUser:1,startsAt:"",endsAt:""}),k.value=!0},E=s=>{I.value="编辑秒杀",Object.assign(o,{...s}),k.value=!0},T=async()=>{U.value&&await U.value.validate(async s=>{if(s)try{o.id?(await X(o.id,o),g.success("更新成功")):(await W(o),g.success("创建成功")),k.value=!1,y()}catch(e){g.error(e.message||"操作失败")}})},x=async(s,e)=>{try{await ee(s.id,e),g.success(e===1?"已开始":"已结束"),y()}catch{g.error("操作失败")}},j=async s=>{try{await K.confirm("确定删除该秒杀吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Z(s.id),g.success("删除成功"),y()}catch(e){e!=="cancel"&&g.error("删除失败")}};return(s,e)=>{const _=r("el-option"),N=r("el-select"),d=r("el-form-item"),c=r("el-button"),M=r("el-form"),S=r("el-card"),i=r("el-table-column"),C=r("el-tag"),R=r("el-table"),h=r("el-pagination"),O=r("el-input"),v=r("el-input-number"),q=r("el-date-picker"),F=r("el-dialog");return f(),J("div",le,[l(S,{class:"search-card"},{default:a(()=>[l(M,{inline:!0,model:p,class:"search-form"},{default:a(()=>[l(d,{label:"状态"},{default:a(()=>[l(N,{modelValue:p.status,"onUpdate:modelValue":e[0]||(e[0]=t=>p.status=t),placeholder:"全部",clearable:"",style:{width:"150px"}},{default:a(()=>[l(_,{label:"未开始",value:0}),l(_,{label:"进行中",value:1}),l(_,{label:"已结束",value:2}),l(_,{label:"已取消",value:3})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(c,{type:"primary",onClick:P},{default:a(()=>[...e[13]||(e[13]=[n("查询",-1)])]),_:1}),l(c,{onClick:$},{default:a(()=>[...e[14]||(e[14]=[n("重置",-1)])]),_:1}),l(c,{type:"success",onClick:B},{default:a(()=>[...e[15]||(e[15]=[n("创建秒杀",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(S,{class:"table-card"},{default:a(()=>[l(R,{data:A.value,border:"",style:{width:"100%"}},{default:a(()=>[l(i,{prop:"id",label:"ID",width:"80"}),l(i,{prop:"title",label:"秒杀标题",width:"200"}),l(i,{prop:"seckillPrice",label:"秒杀价",width:"100"}),l(i,{prop:"originalPrice",label:"原价",width:"100"}),l(i,{prop:"availableInventory",label:"剩余库存",width:"100"}),l(i,{prop:"totalInventory",label:"总库存",width:"100"}),l(i,{prop:"limitPerUser",label:"限购数",width:"80"}),l(i,{prop:"startsAt",label:"开始时间",width:"160"}),l(i,{prop:"endsAt",label:"结束时间",width:"160"}),l(i,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[t.status===0?(f(),b(C,{key:0,type:"info"},{default:a(()=>[...e[16]||(e[16]=[n("未开始",-1)])]),_:1})):t.status===1?(f(),b(C,{key:1,type:"success"},{default:a(()=>[...e[17]||(e[17]=[n("进行中",-1)])]),_:1})):t.status===2?(f(),b(C,{key:2,type:"warning"},{default:a(()=>[...e[18]||(e[18]=[n("已结束",-1)])]),_:1})):t.status===3?(f(),b(C,{key:3,type:"danger"},{default:a(()=>[...e[19]||(e[19]=[n("已取消",-1)])]),_:1})):D("",!0)]),_:1}),l(i,{label:"操作",fixed:"right",width:"200"},{default:a(({row:t})=>[l(c,{link:"",type:"primary",size:"small",onClick:Y=>E(t)},{default:a(()=>[...e[20]||(e[20]=[n("编辑",-1)])]),_:1},8,["onClick"]),t.status===0?(f(),b(c,{key:0,link:"",type:"success",size:"small",onClick:Y=>x(t,1)},{default:a(()=>[...e[21]||(e[21]=[n("开始",-1)])]),_:1},8,["onClick"])):D("",!0),t.status===1?(f(),b(c,{key:1,link:"",type:"warning",size:"small",onClick:Y=>x(t,2)},{default:a(()=>[...e[22]||(e[22]=[n("结束",-1)])]),_:1},8,["onClick"])):D("",!0),l(c,{link:"",type:"danger",size:"small",onClick:Y=>j(t)},{default:a(()=>[...e[23]||(e[23]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(h,{"current-page":m.page,"onUpdate:currentPage":e[1]||(e[1]=t=>m.page=t),"page-size":m.size,"onUpdate:pageSize":e[2]||(e[2]=t=>m.size=t),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:P},null,8,["current-page","page-size","total"])]),_:1}),l(F,{modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=t=>k.value=t),title:I.value,width:"600px"},{footer:a(()=>[l(c,{onClick:e[11]||(e[11]=t=>k.value=!1)},{default:a(()=>[...e[24]||(e[24]=[n("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:T},{default:a(()=>[...e[25]||(e[25]=[n("确定",-1)])]),_:1})]),default:a(()=>[l(M,{model:o,rules:H,ref_key:"formRef",ref:U,"label-width":"120px"},{default:a(()=>[l(d,{label:"秒杀标题",prop:"title"},{default:a(()=>[l(O,{modelValue:o.title,"onUpdate:modelValue":e[3]||(e[3]=t=>o.title=t),placeholder:"请输入秒杀标题"},null,8,["modelValue"])]),_:1}),l(d,{label:"商品ID",prop:"productId"},{default:a(()=>[l(v,{modelValue:o.productId,"onUpdate:modelValue":e[4]||(e[4]=t=>o.productId=t),min:1,placeholder:"请输入商品ID"},null,8,["modelValue"])]),_:1}),l(d,{label:"秒杀价",prop:"seckillPrice"},{default:a(()=>[l(v,{modelValue:o.seckillPrice,"onUpdate:modelValue":e[5]||(e[5]=t=>o.seckillPrice=t),min:0,precision:2,placeholder:"请输入秒杀价"},null,8,["modelValue"])]),_:1}),l(d,{label:"原价",prop:"originalPrice"},{default:a(()=>[l(v,{modelValue:o.originalPrice,"onUpdate:modelValue":e[6]||(e[6]=t=>o.originalPrice=t),min:0,precision:2,placeholder:"请输入原价"},null,8,["modelValue"])]),_:1}),l(d,{label:"总库存",prop:"totalInventory"},{default:a(()=>[l(v,{modelValue:o.totalInventory,"onUpdate:modelValue":e[7]||(e[7]=t=>o.totalInventory=t),min:1,placeholder:"请输入总库存"},null,8,["modelValue"])]),_:1}),l(d,{label:"每人限购",prop:"limitPerUser"},{default:a(()=>[l(v,{modelValue:o.limitPerUser,"onUpdate:modelValue":e[8]||(e[8]=t=>o.limitPerUser=t),min:1,placeholder:"每人限购数量"},null,8,["modelValue"])]),_:1}),l(d,{label:"开始时间",prop:"startsAt"},{default:a(()=>[l(q,{modelValue:o.startsAt,"onUpdate:modelValue":e[9]||(e[9]=t=>o.startsAt=t),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(d,{label:"结束时间",prop:"endsAt"},{default:a(()=>[l(q,{modelValue:o.endsAt,"onUpdate:modelValue":e[10]||(e[10]=t=>o.endsAt=t),type:"datetime",placeholder:"选择结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},re=L(te,[["__scopeId","data-v-24e1f572"]]);export{re as default};
