import{e as H}from"./scenic-DEiLY1DV.js";import{g as K,u as Q,d as W}from"./ticket-_WwThDGt.js";import{_ as X,a as $,r as S,h as Y,c as D,o as m,b as t,w as n,d as i,E as f,u as Z,i as ee,F as te,n as ae,k,q as _,s as le,f as r,v as ne,j as se,g as C,t as B,x as oe,y as ie,z as ce,A as re,m as I}from"./index-Dl6qxkSp.js";import"./request-CPaEfZlY.js";const de={class:"ticket-list"},ue={class:"card-header"},pe={class:"price"},me={__name:"TicketList",setup(fe){const h=Z(),s=$({scenicSpotId:null,name:"",status:null}),z=S([]),x=S([]),b=S(!1),o=$({page:1,size:10,total:0}),N=async()=>{try{const a=await H({size:1e3});x.value=a.content||[]}catch{f.error("加载景区列表失败")}},p=async()=>{b.value=!0;try{const a={page:o.page-1,size:o.size};s.scenicSpotId&&(a.scenicSpotId=s.scenicSpotId),s.name&&(a.name=s.name),s.status!==null&&s.status!==void 0&&(a.status=s.status),console.log("[TicketList] loadData 请求参数:",JSON.parse(JSON.stringify(a)));const e=await K(a);console.log("[TicketList] loadData 返回数据:",e),z.value=e.content||[],o.total=e.totalElements||0}catch(a){console.error("[TicketList] loadData 错误:",a),f.error("加载数据失败")}finally{b.value=!1}},T=()=>{console.log("[TicketList] handleSearch 触发，searchForm:",JSON.parse(JSON.stringify(s))),o.page=1,p()},L=()=>{Object.assign(s,{scenicSpotId:null,name:"",status:null}),T()},E=()=>{h.push("/tickets/create")},O=a=>{h.push(`/tickets/edit/${a.id}`)},U=a=>{h.push(`/tickets/prices/${a.id}`)},F=a=>{I.confirm(`确定要删除票种"${a.name}"吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await W(a.id),f.success("删除成功"),p()}catch{f.error("删除失败")}}).catch(()=>{})},w=(a,e)=>{const u=e===1?"上架":"下架";I.confirm(`确定要${u}票种"${a.name}"吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Q(a.id,e),f.success(`${u}成功`),p()}catch{f.error(`${u}失败`)}}).catch(()=>{})},J=a=>{o.size=a,p()},P=a=>{o.page=a,p()};return Y(()=>{N(),p()}),(a,e)=>{const u=i("el-option"),v=i("el-select"),g=i("el-form-item"),j=i("el-input"),d=i("el-button"),M=i("el-form"),V=i("el-card"),c=i("el-table-column"),R=i("el-tag"),q=i("el-table"),A=i("el-pagination"),G=ee("loading");return m(),D("div",de,[t(V,{class:"search-card"},{default:n(()=>[t(M,{inline:!0,model:s,class:"search-form"},{default:n(()=>[t(g,{label:"景区"},{default:n(()=>[t(v,{modelValue:s.scenicSpotId,"onUpdate:modelValue":e[0]||(e[0]=l=>s.scenicSpotId=l),placeholder:"请选择景区",clearable:"",style:{width:"200px"}},{default:n(()=>[(m(!0),D(te,null,ae(x.value,l=>(m(),k(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"票种名称"},{default:n(()=>[t(j,{modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=l=>s.name=l),placeholder:"请输入票种名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(g,{label:"状态"},{default:n(()=>[t(v,{modelValue:s.status,"onUpdate:modelValue":e[2]||(e[2]=l=>s.status=l),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:n(()=>[t(u,{label:"已上架",value:1}),t(u,{label:"已下架",value:0})]),_:1},8,["modelValue"])]),_:1}),t(g,null,{default:n(()=>[t(d,{type:"primary",onClick:T,icon:_(le)},{default:n(()=>[...e[5]||(e[5]=[r("搜索",-1)])]),_:1},8,["icon"]),t(d,{onClick:L,icon:_(ne)},{default:n(()=>[...e[6]||(e[6]=[r("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{class:"table-card"},{header:n(()=>[C("div",ue,[e[8]||(e[8]=C("span",null,"票种列表",-1)),t(d,{type:"primary",onClick:E,icon:_(re)},{default:n(()=>[...e[7]||(e[7]=[r("创建票种",-1)])]),_:1},8,["icon"])])]),default:n(()=>[se((m(),k(q,{data:z.value,border:""},{default:n(()=>[t(c,{prop:"id",label:"ID",width:"80"}),t(c,{prop:"scenicSpotName",label:"景区",width:"150"}),t(c,{prop:"name",label:"票种名称",width:"200"}),t(c,{prop:"typeText",label:"类型",width:"100"}),t(c,{prop:"validityTypeText",label:"有效期类型",width:"120"}),t(c,{prop:"sellPrice",label:"售价",width:"100"},{default:n(({row:l})=>[C("span",pe,"¥"+B(l.minPrice||"未设置"),1)]),_:1}),t(c,{prop:"status",label:"状态",width:"100"},{default:n(({row:l})=>[t(R,{type:l.status===1?"success":"info"},{default:n(()=>[r(B(l.statusText),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"createTime",label:"创建时间",width:"180"}),t(c,{label:"操作",width:"280",fixed:"right"},{default:n(({row:l})=>[t(d,{type:"primary",size:"small",onClick:y=>U(l),icon:_(oe)},{default:n(()=>[...e[9]||(e[9]=[r("票价设置",-1)])]),_:1},8,["onClick","icon"]),t(d,{type:"warning",size:"small",onClick:y=>O(l),icon:_(ie)},{default:n(()=>[...e[10]||(e[10]=[r("编辑",-1)])]),_:1},8,["onClick","icon"]),l.status===1?(m(),k(d,{key:0,type:"info",size:"small",onClick:y=>w(l,0)},{default:n(()=>[...e[11]||(e[11]=[r("下架",-1)])]),_:1},8,["onClick"])):(m(),k(d,{key:1,type:"success",size:"small",onClick:y=>w(l,1)},{default:n(()=>[...e[12]||(e[12]=[r("上架",-1)])]),_:1},8,["onClick"])),t(d,{type:"danger",size:"small",onClick:y=>F(l),icon:_(ce)},{default:n(()=>[...e[13]||(e[13]=[r("删除",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[G,b.value]]),t(A,{"current-page":o.page,"onUpdate:currentPage":e[3]||(e[3]=l=>o.page=l),"page-size":o.size,"onUpdate:pageSize":e[4]||(e[4]=l=>o.size=l),total:o.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:P,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1})])}}},he=X(me,[["__scopeId","data-v-2396df9c"]]);export{he as default};
