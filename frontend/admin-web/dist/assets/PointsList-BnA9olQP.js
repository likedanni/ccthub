import{r as R}from"./request-Cl0XkbGx.js";import{_ as T,r as _,h as F,c as H,o as U,b as l,w as t,d as n,E as x,u as G,i as J,j as K,f as p,g as s,t as g,k as O}from"./index-BxrhVYt3.js";function Q(I){return R({url:"/points/list",method:"get",params:I})}const W={class:"points-list"},X={class:"stat-card"},Y={class:"stat-value"},Z={class:"stat-card"},ee={class:"stat-value text-success"},le={class:"stat-card"},te={class:"stat-value text-primary"},ae={class:"stat-card"},oe={class:"stat-value text-danger"},se={class:"points-balance"},ne={__name:"PointsList",setup(I){const h=G(),k=_(!1),d=_({userId:"",phone:""}),y=_({totalUsers:0,totalPoints:0,todayEarned:0,todaySpent:0}),V=_([]),r=_({page:1,size:10,total:0}),o=_({visible:!1,form:{userId:"",currentBalance:0,type:1,points:0,remark:""}}),v=async()=>{k.value=!0;try{const u={userId:d.value.userId,phone:d.value.phone,page:r.value.page-1,size:r.value.size},e=await Q(u);e.success&&e.data?(V.value=e.data.records||[],r.value.total=e.data.total||0):(V.value=[],r.value.total=0,x.error(e.message||"获取数据失败"))}catch(u){console.error("查询积分列表失败:",u),x.error("查询失败："+(u.message||"未知错误")),V.value=[],r.value.total=0}finally{k.value=!1}},B=()=>{d.value={userId:"",phone:""},v()},D=u=>{h.push({path:"/points/transactions",query:{userId:u.userId}})},E=u=>{o.value.form={userId:u.userId,currentBalance:u.currentBalance,type:1,points:0,remark:""},o.value.visible=!0},S=()=>{x.success("调整成功"),o.value.visible=!1,v()};return F(()=>{v()}),(u,e)=>{const c=n("el-input"),i=n("el-form-item"),f=n("el-button"),C=n("el-form"),b=n("el-card"),w=n("el-col"),j=n("el-row"),m=n("el-table-column"),P=n("el-table"),N=n("el-pagination"),z=n("el-radio"),$=n("el-radio-group"),q=n("el-input-number"),A=n("el-dialog"),L=J("loading");return U(),H("div",W,[l(b,null,{header:t(()=>[...e[11]||(e[11]=[s("div",{class:"card-header"},[s("span",null,"用户积分管理")],-1)])]),default:t(()=>[l(C,{inline:!0,model:d.value,class:"search-form"},{default:t(()=>[l(i,{label:"用户ID"},{default:t(()=>[l(c,{modelValue:d.value.userId,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value.userId=a),placeholder:"请输入用户名、手机号或ID",clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"手机号"},{default:t(()=>[l(c,{modelValue:d.value.phone,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value.phone=a),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(f,{type:"primary",onClick:v},{default:t(()=>[...e[12]||(e[12]=[p("查询",-1)])]),_:1}),l(f,{onClick:B},{default:t(()=>[...e[13]||(e[13]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),l(j,{gutter:20,style:{"margin-bottom":"20px"}},{default:t(()=>[l(w,{span:6},{default:t(()=>[l(b,{shadow:"hover"},{default:t(()=>[s("div",X,[e[14]||(e[14]=s("div",{class:"stat-label"},"总用户数",-1)),s("div",Y,g(y.value.totalUsers),1)])]),_:1})]),_:1}),l(w,{span:6},{default:t(()=>[l(b,{shadow:"hover"},{default:t(()=>[s("div",Z,[e[15]||(e[15]=s("div",{class:"stat-label"},"总积分",-1)),s("div",ee,g(y.value.totalPoints),1)])]),_:1})]),_:1}),l(w,{span:6},{default:t(()=>[l(b,{shadow:"hover"},{default:t(()=>[s("div",le,[e[16]||(e[16]=s("div",{class:"stat-label"},"今日发放",-1)),s("div",te,g(y.value.todayEarned),1)])]),_:1})]),_:1}),l(w,{span:6},{default:t(()=>[l(b,{shadow:"hover"},{default:t(()=>[s("div",ae,[e[17]||(e[17]=s("div",{class:"stat-label"},"今日消耗",-1)),s("div",oe,g(y.value.todaySpent),1)])]),_:1})]),_:1})]),_:1}),K((U(),O(P,{data:V.value,border:"",style:{width:"100%"}},{default:t(()=>[l(m,{prop:"nickname",label:"用户名",width:"120","show-overflow-tooltip":""}),l(m,{prop:"phone",label:"手机号",width:"120"}),l(m,{prop:"currentBalance",label:"当前积分",width:"120"},{default:t(a=>[s("span",se,g(a.row.currentBalance),1)]),_:1}),l(m,{prop:"totalEarned",label:"累计获得",width:"120"}),l(m,{prop:"totalSpent",label:"累计消耗",width:"120"}),l(m,{prop:"lastEarnTime",label:"最近获得时间",width:"160"}),l(m,{label:"操作",width:"180",fixed:"right"},{default:t(a=>[l(f,{type:"primary",size:"small",onClick:M=>D(a.row)},{default:t(()=>[...e[18]||(e[18]=[p(" 查看流水 ",-1)])]),_:1},8,["onClick"]),l(f,{type:"success",size:"small",onClick:M=>E(a.row)},{default:t(()=>[...e[19]||(e[19]=[p(" 调整积分 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,k.value]]),l(N,{"current-page":r.value.page,"onUpdate:currentPage":e[2]||(e[2]=a=>r.value.page=a),"page-size":r.value.size,"onUpdate:pageSize":e[3]||(e[3]=a=>r.value.size=a),total:r.value.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),l(A,{modelValue:o.value.visible,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.visible=a),title:"调整积分",width:"500px"},{footer:t(()=>[l(f,{onClick:e[9]||(e[9]=a=>o.value.visible=!1)},{default:t(()=>[...e[22]||(e[22]=[p("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:S},{default:t(()=>[...e[23]||(e[23]=[p("确定",-1)])]),_:1})]),default:t(()=>[l(C,{model:o.value.form,"label-width":"100px"},{default:t(()=>[l(i,{label:"用户ID"},{default:t(()=>[l(c,{modelValue:o.value.form.userId,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.form.userId=a),disabled:""},null,8,["modelValue"])]),_:1}),l(i,{label:"当前积分"},{default:t(()=>[l(c,{modelValue:o.value.form.currentBalance,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.form.currentBalance=a),disabled:""},null,8,["modelValue"])]),_:1}),l(i,{label:"调整类型"},{default:t(()=>[l($,{modelValue:o.value.form.type,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.form.type=a)},{default:t(()=>[l(z,{label:1},{default:t(()=>[...e[20]||(e[20]=[p("增加",-1)])]),_:1}),l(z,{label:2},{default:t(()=>[...e[21]||(e[21]=[p("减少",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"调整积分"},{default:t(()=>[l(q,{modelValue:o.value.form.points,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.form.points=a),min:1,max:1e5},null,8,["modelValue"])]),_:1}),l(i,{label:"备注"},{default:t(()=>[l(c,{modelValue:o.value.form.remark,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.form.remark=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},de=T(ne,[["__scopeId","data-v-77f1a858"]]);export{de as default};
