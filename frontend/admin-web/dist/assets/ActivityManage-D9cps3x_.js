import{r as U}from"./request-Ba914Fe9.js";import{_ as W,a as M,r as z,h as X,E as y,c as Z,o as r,b as t,w as a,d,f as n,k as s,l as c,m as h}from"./index-ch6PX-9l.js";function ee(m){return U({url:"/api/activities",method:"get",params:m})}function te(m){return U({url:"/api/activities",method:"post",data:m})}function le(m,u){return U({url:`/api/activities/${m}`,method:"put",data:u})}function ae(m){return U({url:`/api/activities/${m}`,method:"delete"})}function oe(m,u){return U({url:`/api/activities/${m}/audit`,method:"put",params:{auditStatus:u}})}function ne(m,u){return U({url:`/api/activities/${m}/status`,method:"put",params:{status:u}})}const ue={class:"activity-manage"},ie={__name:"ActivityManage",setup(m){const u=M({keyword:"",type:null,status:null,auditStatus:null}),D=z([]),V=M({page:1,size:10,total:0}),_=z(!1),q=z("创建活动"),S=z(null),o=M({id:null,merchantId:1,name:"",type:1,coverImage:"",description:"",startsAt:"",endsAt:"",location:"",participationLimit:0,requirementType:1,requirementValue:0,rewardConfig:'{"type":"points","value":100}'}),j={name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],type:[{required:!0,message:"请选择活动类型",trigger:"change"}],startsAt:[{required:!0,message:"请选择开始时间",trigger:"change"}],endsAt:[{required:!0,message:"请选择结束时间",trigger:"change"}],rewardConfig:[{required:!0,message:"请输入奖励配置",trigger:"blur"}]};X(()=>{C()});const C=async()=>{try{const p={...u,page:V.page-1,size:V.size},e=await ee(p);D.value=e.content,V.total=e.totalElements}catch{y.error("获取活动列表失败")}},x=()=>{V.page=1,C()},N=()=>{Object.assign(u,{keyword:"",type:null,status:null,auditStatus:null}),x()},O=()=>{q.value="创建活动",Object.assign(o,{id:null,merchantId:1,name:"",type:1,coverImage:"",description:"",startsAt:"",endsAt:"",location:"",participationLimit:0,requirementType:1,requirementValue:0,rewardConfig:'{"type":"points","value":100}'}),_.value=!0},R=p=>{q.value="编辑活动",Object.assign(o,{...p}),_.value=!0},F=async()=>{S.value&&await S.value.validate(async p=>{if(p)try{o.id?(await le(o.id,o),y.success("更新成功")):(await te(o),y.success("创建成功")),_.value=!1,C()}catch(e){y.error(e.message||"操作失败")}})},$=async(p,e)=>{try{await oe(p.id,e),y.success(e===1?"审核通过":"审核拒绝"),C()}catch{y.error("审核失败")}},T=async(p,e)=>{try{await ne(p.id,e),y.success(e===1?"上线成功":"下线成功"),C()}catch{y.error("操作失败")}},J=async p=>{try{await h.confirm("确定删除该活动吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ae(p.id),y.success("删除成功"),C()}catch(e){e!=="cancel"&&y.error("删除失败")}},P=p=>{y.info("查看功能待实现")};return(p,e)=>{const b=d("el-input"),i=d("el-form-item"),g=d("el-option"),Y=d("el-select"),f=d("el-button"),I=d("el-form"),H=d("el-card"),k=d("el-table-column"),v=d("el-tag"),G=d("el-table"),K=d("el-pagination"),w=d("el-radio"),L=d("el-radio-group"),B=d("el-date-picker"),E=d("el-input-number"),Q=d("el-dialog");return r(),Z("div",ue,[t(H,{class:"search-card"},{default:a(()=>[t(I,{inline:!0,model:u,class:"search-form"},{default:a(()=>[t(i,{label:"活动名称"},{default:a(()=>[t(b,{modelValue:u.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>u.keyword=l),placeholder:"请输入活动名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(i,{label:"活动类型"},{default:a(()=>[t(Y,{modelValue:u.type,"onUpdate:modelValue":e[1]||(e[1]=l=>u.type=l),placeholder:"全部",clearable:"",style:{width:"150px"}},{default:a(()=>[t(g,{label:"打卡任务",value:1}),t(g,{label:"积分奖励",value:2}),t(g,{label:"主题促销",value:3})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"审核状态"},{default:a(()=>[t(Y,{modelValue:u.auditStatus,"onUpdate:modelValue":e[2]||(e[2]=l=>u.auditStatus=l),placeholder:"全部",clearable:"",style:{width:"150px"}},{default:a(()=>[t(g,{label:"待审核",value:0}),t(g,{label:"审核通过",value:1}),t(g,{label:"审核拒绝",value:2})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"活动状态"},{default:a(()=>[t(Y,{modelValue:u.status,"onUpdate:modelValue":e[3]||(e[3]=l=>u.status=l),placeholder:"全部",clearable:"",style:{width:"150px"}},{default:a(()=>[t(g,{label:"未开始",value:0}),t(g,{label:"进行中",value:1}),t(g,{label:"已结束",value:2}),t(g,{label:"已取消",value:3})]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(f,{type:"primary",onClick:x},{default:a(()=>[...e[19]||(e[19]=[n("查询",-1)])]),_:1}),t(f,{onClick:N},{default:a(()=>[...e[20]||(e[20]=[n("重置",-1)])]),_:1}),t(f,{type:"success",onClick:O},{default:a(()=>[...e[21]||(e[21]=[n("创建活动",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(H,{class:"table-card"},{default:a(()=>[t(G,{data:D.value,border:"",style:{width:"100%"}},{default:a(()=>[t(k,{prop:"id",label:"ID",width:"80"}),t(k,{prop:"name",label:"活动名称",width:"200"}),t(k,{prop:"type",label:"活动类型",width:"100"},{default:a(({row:l})=>[l.type===1?(r(),s(v,{key:0,type:"info"},{default:a(()=>[...e[22]||(e[22]=[n("打卡任务",-1)])]),_:1})):l.type===2?(r(),s(v,{key:1,type:"success"},{default:a(()=>[...e[23]||(e[23]=[n("积分奖励",-1)])]),_:1})):l.type===3?(r(),s(v,{key:2,type:"warning"},{default:a(()=>[...e[24]||(e[24]=[n("主题促销",-1)])]),_:1})):c("",!0)]),_:1}),t(k,{prop:"startsAt",label:"开始时间",width:"160"}),t(k,{prop:"endsAt",label:"结束时间",width:"160"}),t(k,{prop:"auditStatus",label:"审核状态",width:"100"},{default:a(({row:l})=>[l.auditStatus===0?(r(),s(v,{key:0,type:"warning"},{default:a(()=>[...e[25]||(e[25]=[n("待审核",-1)])]),_:1})):l.auditStatus===1?(r(),s(v,{key:1,type:"success"},{default:a(()=>[...e[26]||(e[26]=[n("审核通过",-1)])]),_:1})):l.auditStatus===2?(r(),s(v,{key:2,type:"danger"},{default:a(()=>[...e[27]||(e[27]=[n("审核拒绝",-1)])]),_:1})):c("",!0)]),_:1}),t(k,{prop:"status",label:"活动状态",width:"100"},{default:a(({row:l})=>[l.status===0?(r(),s(v,{key:0,type:"info"},{default:a(()=>[...e[28]||(e[28]=[n("未开始",-1)])]),_:1})):l.status===1?(r(),s(v,{key:1,type:"success"},{default:a(()=>[...e[29]||(e[29]=[n("进行中",-1)])]),_:1})):l.status===2?(r(),s(v,{key:2,type:"warning"},{default:a(()=>[...e[30]||(e[30]=[n("已结束",-1)])]),_:1})):l.status===3?(r(),s(v,{key:3,type:"danger"},{default:a(()=>[...e[31]||(e[31]=[n("已取消",-1)])]),_:1})):c("",!0)]),_:1}),t(k,{label:"操作",fixed:"right",width:"300"},{default:a(({row:l})=>[t(f,{link:"",type:"primary",size:"small",onClick:A=>P(l)},{default:a(()=>[...e[32]||(e[32]=[n("查看",-1)])]),_:1},8,["onClick"]),t(f,{link:"",type:"primary",size:"small",onClick:A=>R(l)},{default:a(()=>[...e[33]||(e[33]=[n("编辑",-1)])]),_:1},8,["onClick"]),l.auditStatus===0?(r(),s(f,{key:0,link:"",type:"success",size:"small",onClick:A=>$(l,1)},{default:a(()=>[...e[34]||(e[34]=[n("通过",-1)])]),_:1},8,["onClick"])):c("",!0),l.auditStatus===0?(r(),s(f,{key:1,link:"",type:"danger",size:"small",onClick:A=>$(l,2)},{default:a(()=>[...e[35]||(e[35]=[n("拒绝",-1)])]),_:1},8,["onClick"])):c("",!0),l.status===0&&l.auditStatus===1?(r(),s(f,{key:2,link:"",type:"success",size:"small",onClick:A=>T(l,1)},{default:a(()=>[...e[36]||(e[36]=[n("上线",-1)])]),_:1},8,["onClick"])):c("",!0),l.status===1?(r(),s(f,{key:3,link:"",type:"warning",size:"small",onClick:A=>T(l,2)},{default:a(()=>[...e[37]||(e[37]=[n("下线",-1)])]),_:1},8,["onClick"])):c("",!0),t(f,{link:"",type:"danger",size:"small",onClick:A=>J(l)},{default:a(()=>[...e[38]||(e[38]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t(K,{"current-page":V.page,"onUpdate:currentPage":e[4]||(e[4]=l=>V.page=l),"page-size":V.size,"onUpdate:pageSize":e[5]||(e[5]=l=>V.size=l),total:V.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:x,onCurrentChange:x},null,8,["current-page","page-size","total"])]),_:1}),t(Q,{modelValue:_.value,"onUpdate:modelValue":e[18]||(e[18]=l=>_.value=l),title:q.value,width:"800px"},{footer:a(()=>[t(f,{onClick:e[17]||(e[17]=l=>_.value=!1)},{default:a(()=>[...e[45]||(e[45]=[n("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:F},{default:a(()=>[...e[46]||(e[46]=[n("确定",-1)])]),_:1})]),default:a(()=>[t(I,{model:o,rules:j,ref_key:"formRef",ref:S,"label-width":"120px"},{default:a(()=>[t(i,{label:"活动名称",prop:"name"},{default:a(()=>[t(b,{modelValue:o.name,"onUpdate:modelValue":e[6]||(e[6]=l=>o.name=l),placeholder:"请输入活动名称"},null,8,["modelValue"])]),_:1}),t(i,{label:"活动类型",prop:"type"},{default:a(()=>[t(L,{modelValue:o.type,"onUpdate:modelValue":e[7]||(e[7]=l=>o.type=l)},{default:a(()=>[t(w,{value:1},{default:a(()=>[...e[39]||(e[39]=[n("打卡任务",-1)])]),_:1}),t(w,{value:2},{default:a(()=>[...e[40]||(e[40]=[n("积分奖励",-1)])]),_:1}),t(w,{value:3},{default:a(()=>[...e[41]||(e[41]=[n("主题促销",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"封面图片",prop:"coverImage"},{default:a(()=>[t(b,{modelValue:o.coverImage,"onUpdate:modelValue":e[8]||(e[8]=l=>o.coverImage=l),placeholder:"请输入图片URL"},null,8,["modelValue"])]),_:1}),t(i,{label:"活动描述",prop:"description"},{default:a(()=>[t(b,{modelValue:o.description,"onUpdate:modelValue":e[9]||(e[9]=l=>o.description=l),type:"textarea",rows:4,placeholder:"请输入活动描述"},null,8,["modelValue"])]),_:1}),t(i,{label:"开始时间",prop:"startsAt"},{default:a(()=>[t(B,{modelValue:o.startsAt,"onUpdate:modelValue":e[10]||(e[10]=l=>o.startsAt=l),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(i,{label:"结束时间",prop:"endsAt"},{default:a(()=>[t(B,{modelValue:o.endsAt,"onUpdate:modelValue":e[11]||(e[11]=l=>o.endsAt=l),type:"datetime",placeholder:"选择结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(i,{label:"活动地点",prop:"location"},{default:a(()=>[t(b,{modelValue:o.location,"onUpdate:modelValue":e[12]||(e[12]=l=>o.location=l),placeholder:"请输入活动地点"},null,8,["modelValue"])]),_:1}),t(i,{label:"参与人数限制",prop:"participationLimit"},{default:a(()=>[t(E,{modelValue:o.participationLimit,"onUpdate:modelValue":e[13]||(e[13]=l=>o.participationLimit=l),min:0,placeholder:"0表示不限制"},null,8,["modelValue"])]),_:1}),t(i,{label:"参与要求",prop:"requirementType"},{default:a(()=>[t(L,{modelValue:o.requirementType,"onUpdate:modelValue":e[14]||(e[14]=l=>o.requirementType=l)},{default:a(()=>[t(w,{value:1},{default:a(()=>[...e[42]||(e[42]=[n("无要求",-1)])]),_:1}),t(w,{value:2},{default:a(()=>[...e[43]||(e[43]=[n("等级要求",-1)])]),_:1}),t(w,{value:3},{default:a(()=>[...e[44]||(e[44]=[n("积分要求",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o.requirementType!==1?(r(),s(i,{key:0,label:"要求值",prop:"requirementValue"},{default:a(()=>[t(E,{modelValue:o.requirementValue,"onUpdate:modelValue":e[15]||(e[15]=l=>o.requirementValue=l),min:1},null,8,["modelValue"])]),_:1})):c("",!0),t(i,{label:"奖励配置",prop:"rewardConfig"},{default:a(()=>[t(b,{modelValue:o.rewardConfig,"onUpdate:modelValue":e[16]||(e[16]=l=>o.rewardConfig=l),type:"textarea",rows:3,placeholder:'JSON格式，如：{"type":"points","value":100}'},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},se=W(ie,[["__scopeId","data-v-d7d04d65"]]);export{se as default};
