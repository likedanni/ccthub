import{r as E}from"./request-Ba914Fe9.js";import{_ as te,r as C,a as I,h as ae,c as A,o as m,b as e,w as t,d,E as U,i as le,f as s,g as u,t as n,j as se,k as h,l as j,F as oe,n as ne}from"./index-ch6PX-9l.js";function de(z){return E({url:"/refunds/audit",method:"put",data:z})}function ue(z){return E({url:"/refunds",method:"get",params:z})}function ie(){return E({url:"/refunds/statistics",method:"get"})}const re={class:"refund-management"},pe={class:"stat-content"},ce={class:"stat-value"},fe={class:"stat-content"},_e={class:"stat-value"},me={class:"stat-content"},ve={class:"stat-value"},ge={class:"stat-content"},be={class:"stat-value"},ye={class:"stat-content"},we={class:"stat-value"},Ve={class:"stat-content"},Ne={class:"stat-value"},ke={key:0,class:"evidence-images"},xe={key:1},Re={__name:"RefundList",setup(z){const D=C(!1),S=C([]),T=C(!1),k=C(!1),o=C(null),i=I({orderNo:"",userId:"",status:null,timeRange:[]}),f=I({page:1,size:10,total:0}),b=I({pendingAudit:0,approved:0,rejected:0,refunding:0,success:0,failed:0}),v=I({refundNo:"",auditStatus:null,auditNote:"",auditorId:1}),x=async()=>{var r,a;D.value=!0;try{const y={page:f.page-1,size:f.size,orderNo:i.orderNo||void 0,userId:i.userId||void 0,status:i.status!==null?i.status:void 0,startTime:((r=i.timeRange)==null?void 0:r[0])||void 0,endTime:((a=i.timeRange)==null?void 0:a[1])||void 0},c=await ue(y);c.success&&c.data?(S.value=c.data.records||[],f.total=c.data.total||0):(S.value=[],f.total=0)}catch(y){U.error("加载数据失败："+y.message)}finally{D.value=!1}},$=async()=>{try{const r=await ie();Object.assign(b,r)}catch(r){console.error("加载统计数据失败",r)}},B=()=>{f.page=1,x()},O=()=>{Object.assign(i,{orderNo:"",userId:"",status:null,timeRange:[]}),B()},q=r=>{o.value=r,T.value=!0},F=(r,a)=>{o.value=r,v.refundNo=r.refundNo,v.auditStatus=a,v.auditNote="",k.value=!0},P=async()=>{try{await de(v),U.success("审核成功"),k.value=!1,x(),$()}catch(r){U.error("审核失败："+r.message)}},M=r=>({0:"warning",1:"success",2:"danger",3:"info",4:"success",5:"danger"})[r]||"info";return ae(()=>{x(),$()}),(r,a)=>{const y=d("el-input"),c=d("el-form-item"),V=d("el-option"),G=d("el-select"),J=d("el-date-picker"),w=d("el-button"),Y=d("el-form"),g=d("el-card"),N=d("el-col"),K=d("el-row"),_=d("el-table-column"),L=d("el-tag"),Q=d("el-table"),W=d("el-pagination"),p=d("el-descriptions-item"),X=d("el-image"),Z=d("el-descriptions"),H=d("el-dialog"),ee=le("loading");return m(),A("div",re,[e(g,{class:"search-card"},{default:t(()=>[e(Y,{inline:!0,model:i,class:"search-form"},{default:t(()=>[e(c,{label:"订单号"},{default:t(()=>[e(y,{modelValue:i.orderNo,"onUpdate:modelValue":a[0]||(a[0]=l=>i.orderNo=l),placeholder:"请输入订单号",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"用户ID"},{default:t(()=>[e(y,{modelValue:i.userId,"onUpdate:modelValue":a[1]||(a[1]=l=>i.userId=l),placeholder:"请输入用户名或ID",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"状态"},{default:t(()=>[e(G,{modelValue:i.status,"onUpdate:modelValue":a[2]||(a[2]=l=>i.status=l),placeholder:"请选择状态",clearable:"",style:{width:"150px"}},{default:t(()=>[e(V,{label:"待审核",value:0}),e(V,{label:"审核通过",value:1}),e(V,{label:"审核拒绝",value:2}),e(V,{label:"退款中",value:3}),e(V,{label:"退款成功",value:4}),e(V,{label:"退款失败",value:5})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"时间范围"},{default:t(()=>[e(J,{modelValue:i.timeRange,"onUpdate:modelValue":a[3]||(a[3]=l=>i.timeRange=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(c,null,{default:t(()=>[e(w,{type:"primary",onClick:B},{default:t(()=>[...a[10]||(a[10]=[s("检索",-1)])]),_:1}),e(w,{onClick:O},{default:t(()=>[...a[11]||(a[11]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(K,{gutter:20,class:"stats-row"},{default:t(()=>[e(N,{span:4},{default:t(()=>[e(g,{class:"stat-card warning"},{default:t(()=>[u("div",pe,[a[12]||(a[12]=u("div",{class:"stat-label"},"待审核",-1)),u("div",ce,n(b.pendingAudit||0),1)])]),_:1})]),_:1}),e(N,{span:4},{default:t(()=>[e(g,{class:"stat-card"},{default:t(()=>[u("div",fe,[a[13]||(a[13]=u("div",{class:"stat-label"},"审核通过",-1)),u("div",_e,n(b.approved||0),1)])]),_:1})]),_:1}),e(N,{span:4},{default:t(()=>[e(g,{class:"stat-card danger"},{default:t(()=>[u("div",me,[a[14]||(a[14]=u("div",{class:"stat-label"},"审核拒绝",-1)),u("div",ve,n(b.rejected||0),1)])]),_:1})]),_:1}),e(N,{span:4},{default:t(()=>[e(g,{class:"stat-card info"},{default:t(()=>[u("div",ge,[a[15]||(a[15]=u("div",{class:"stat-label"},"退款中",-1)),u("div",be,n(b.refunding||0),1)])]),_:1})]),_:1}),e(N,{span:4},{default:t(()=>[e(g,{class:"stat-card success"},{default:t(()=>[u("div",ye,[a[16]||(a[16]=u("div",{class:"stat-label"},"退款成功",-1)),u("div",we,n(b.success||0),1)])]),_:1})]),_:1}),e(N,{span:4},{default:t(()=>[e(g,{class:"stat-card danger"},{default:t(()=>[u("div",Ve,[a[17]||(a[17]=u("div",{class:"stat-label"},"退款失败",-1)),u("div",Ne,n(b.failed||0),1)])]),_:1})]),_:1})]),_:1}),e(g,{class:"table-card"},{default:t(()=>[se((m(),h(Q,{data:S.value,border:"",stripe:""},{default:t(()=>[e(_,{prop:"refundNo",label:"退款单号",width:"200"}),e(_,{prop:"orderNo",label:"订单号",width:"200"}),e(_,{prop:"userName",label:"用户名",width:"120","show-overflow-tooltip":""}),e(_,{prop:"refundTypeText",label:"退款类型",width:"100"}),e(_,{prop:"refundAmount",label:"退款金额",width:"120"},{default:t(({row:l})=>[s(" ¥"+n(l.refundAmount),1)]),_:1}),e(_,{prop:"refundReason",label:"退款原因",width:"150","show-overflow-tooltip":""}),e(_,{prop:"statusText",label:"状态",width:"100"},{default:t(({row:l})=>[e(L,{type:M(l.status)},{default:t(()=>[s(n(l.statusText),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"auditNote",label:"审核备注",width:"150","show-overflow-tooltip":""}),e(_,{prop:"createdAt",label:"申请时间",width:"180"}),e(_,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[e(w,{link:"",type:"primary",size:"small",onClick:R=>q(l)},{default:t(()=>[...a[18]||(a[18]=[s("详情",-1)])]),_:1},8,["onClick"]),l.status===0?(m(),h(w,{key:0,link:"",type:"success",size:"small",onClick:R=>F(l,1)},{default:t(()=>[...a[19]||(a[19]=[s(" 通过 ",-1)])]),_:1},8,["onClick"])):j("",!0),l.status===0?(m(),h(w,{key:1,link:"",type:"danger",size:"small",onClick:R=>F(l,2)},{default:t(()=>[...a[20]||(a[20]=[s(" 拒绝 ",-1)])]),_:1},8,["onClick"])):j("",!0)]),_:1})]),_:1},8,["data"])),[[ee,D.value]]),e(W,{"current-page":f.page,"onUpdate:currentPage":a[4]||(a[4]=l=>f.page=l),"page-size":f.size,"onUpdate:pageSize":a[5]||(a[5]=l=>f.size=l),total:f.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:x,onCurrentChange:x,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e(H,{modelValue:T.value,"onUpdate:modelValue":a[6]||(a[6]=l=>T.value=l),title:"退款详情",width:"800px"},{default:t(()=>[o.value?(m(),h(Z,{key:0,column:2,border:""},{default:t(()=>[e(p,{label:"退款单号"},{default:t(()=>[s(n(o.value.refundNo),1)]),_:1}),e(p,{label:"订单号"},{default:t(()=>[s(n(o.value.orderNo),1)]),_:1}),e(p,{label:"用户名"},{default:t(()=>[s(n(o.value.userName||o.value.userId||"-"),1)]),_:1}),e(p,{label:"退款类型"},{default:t(()=>[s(n(o.value.refundTypeText),1)]),_:1}),e(p,{label:"退款金额"},{default:t(()=>[s("¥"+n(o.value.refundAmount),1)]),_:1}),e(p,{label:"状态"},{default:t(()=>[e(L,{type:M(o.value.status)},{default:t(()=>[s(n(o.value.statusText),1)]),_:1},8,["type"])]),_:1}),e(p,{label:"退款原因",span:2},{default:t(()=>[s(n(o.value.refundReason),1)]),_:1}),e(p,{label:"退款凭证",span:2},{default:t(()=>[o.value.refundEvidence?(m(),A("div",ke,[(m(!0),A(oe,null,ne(o.value.refundEvidence.split(","),(l,R)=>(m(),h(X,{key:R,src:l,"preview-src-list":o.value.refundEvidence.split(","),"initial-index":R,style:{width:"100px",height:"100px","margin-right":"10px"},fit:"cover"},null,8,["src","preview-src-list","initial-index"]))),128))])):(m(),A("span",xe,"-"))]),_:1}),e(p,{label:"审核人ID"},{default:t(()=>[s(n(o.value.auditorId||"-"),1)]),_:1}),e(p,{label:"审核时间"},{default:t(()=>[s(n(o.value.auditedAt||"-"),1)]),_:1}),e(p,{label:"审核备注",span:2},{default:t(()=>[s(n(o.value.auditNote||"-"),1)]),_:1}),e(p,{label:"支付渠道退款单号"},{default:t(()=>[s(n(o.value.paymentRefundNo||"-"),1)]),_:1}),e(p,{label:"退款完成时间"},{default:t(()=>[s(n(o.value.paymentRefundAt||"-"),1)]),_:1}),e(p,{label:"申请时间"},{default:t(()=>[s(n(o.value.createdAt),1)]),_:1}),e(p,{label:"更新时间"},{default:t(()=>[s(n(o.value.updatedAt),1)]),_:1})]),_:1})):j("",!0)]),_:1},8,["modelValue"]),e(H,{modelValue:k.value,"onUpdate:modelValue":a[9]||(a[9]=l=>k.value=l),title:v.auditStatus===1?"审核通过":"审核拒绝",width:"500px"},{footer:t(()=>[e(w,{onClick:a[8]||(a[8]=l=>k.value=!1)},{default:t(()=>[...a[21]||(a[21]=[s("取消",-1)])]),_:1}),e(w,{type:"primary",onClick:P},{default:t(()=>[...a[22]||(a[22]=[s("确认",-1)])]),_:1})]),default:t(()=>[e(Y,{model:v,"label-width":"100px"},{default:t(()=>[e(c,{label:"审核备注"},{default:t(()=>[e(y,{modelValue:v.auditNote,"onUpdate:modelValue":a[7]||(a[7]=l=>v.auditNote=l),type:"textarea",rows:4,placeholder:"请输入审核备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ze=te(Re,[["__scopeId","data-v-eb6e93f5"]]);export{ze as default};
