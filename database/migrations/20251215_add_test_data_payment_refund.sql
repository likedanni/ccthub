-- ============================================================
-- 添加支付流水和退款申请测试数据
-- 创建时间: 2025-12-15
-- ============================================================
-- 插入支付流水测试数据
INSERT INTO `payments` (
        `payment_no`,
        `order_no`,
        `payment_type`,
        `payment_channel`,
        `payment_amount`,
        `status`,
        `third_party_no`,
        `payer_id`,
        `payment_time`,
        `callback_time`,
        `create_time`
    )
VALUES -- 成功的支付记录
    (
        'PAY202512150001',
        'ORDER202512150001',
        'wechat',
        'miniapp',
        298.00,
        1,
        'WX20251215001',
        'oABC123',
        '2025-12-15 09:30:00',
        '2025-12-15 09:30:05',
        '2025-12-15 09:28:00'
    ),
    (
        'PAY202512150002',
        'ORDER202512150002',
        'alipay',
        'app',
        568.00,
        1,
        'ALI20251215001',
        '2088123456789',
        '2025-12-15 10:15:00',
        '2025-12-15 10:15:03',
        '2025-12-15 10:12:00'
    ),
    (
        'PAY202512150003',
        'ORDER202512150003',
        'wechat',
        'h5',
        128.00,
        1,
        'WX20251215002',
        'oXYZ789',
        '2025-12-15 11:20:00',
        '2025-12-15 11:20:04',
        '2025-12-15 11:18:00'
    ),
    (
        'PAY202512150004',
        'ORDER202512150004',
        'wechat',
        'miniapp',
        99.00,
        1,
        'WX20251215003',
        'oDEF456',
        '2025-12-15 13:45:00',
        '2025-12-15 13:45:06',
        '2025-12-15 13:42:00'
    ),
    (
        'PAY202512150005',
        'ORDER202512150005',
        'alipay',
        'h5',
        388.00,
        1,
        'ALI20251215002',
        '2088987654321',
        '2025-12-15 14:30:00',
        '2025-12-15 14:30:02',
        '2025-12-15 14:28:00'
    ),
    -- 待支付记录
    (
        'PAY202512150006',
        'ORDER202512150006',
        'wechat',
        'miniapp',
        158.00,
        0,
        NULL,
        NULL,
        NULL,
        NULL,
        '2025-12-15 15:20:00'
    ),
    (
        'PAY202512150007',
        'ORDER202512150007',
        'alipay',
        'app',
        268.00,
        0,
        NULL,
        NULL,
        NULL,
        NULL,
        '2025-12-15 15:35:00'
    ),
    -- 失败的支付记录
    (
        'PAY202512150008',
        'ORDER202512150008',
        'wechat',
        'h5',
        199.00,
        2,
        'WX20251215004',
        'oGHI789',
        NULL,
        '2025-12-15 16:10:05',
        '2025-12-15 16:08:00'
    ),
    -- 已关闭的支付记录
    (
        'PAY202512150009',
        'ORDER202512150009',
        'wechat',
        'miniapp',
        328.00,
        3,
        NULL,
        NULL,
        NULL,
        NULL,
        '2025-12-14 18:00:00'
    ),
    -- 处理中的支付记录
    (
        'PAY202512150010',
        'ORDER202512150010',
        'alipay',
        'app',
        458.00,
        4,
        'ALI20251215003',
        '2088111222333',
        NULL,
        NULL,
        '2025-12-15 16:50:00'
    );
-- 插入退款申请测试数据
INSERT INTO `refund_orders` (
        `refund_no`,
        `order_no`,
        `user_id`,
        `refund_amount`,
        `refund_fee`,
        `actual_refund_amount`,
        `refund_reason`,
        `refund_type`,
        `status`,
        `apply_time`,
        `approve_time`,
        `refund_time`,
        `reject_reason`
    )
VALUES -- 已完成的退款
    (
        'REFUND202512150001',
        'ORDER202512150001',
        1,
        298.00,
        0.00,
        298.00,
        '行程取消，无法前往',
        1,
        3,
        '2025-12-15 10:00:00',
        '2025-12-15 10:05:00',
        '2025-12-15 10:10:00',
        NULL
    ),
    (
        'REFUND202512150002',
        'ORDER202512150002',
        2,
        568.00,
        28.40,
        539.60,
        '临时有事，无法游览',
        1,
        3,
        '2025-12-15 11:30:00',
        '2025-12-15 11:35:00',
        '2025-12-15 11:40:00',
        NULL
    ),
    -- 审核中的退款
    (
        'REFUND202512150003',
        'ORDER202512150003',
        3,
        128.00,
        0.00,
        128.00,
        '订单重复下单',
        1,
        1,
        '2025-12-15 12:00:00',
        NULL,
        NULL,
        NULL
    ),
    (
        'REFUND202512150004',
        'ORDER202512150004',
        4,
        99.00,
        4.95,
        94.05,
        '天气原因，不适宜出行',
        1,
        1,
        '2025-12-15 14:00:00',
        NULL,
        NULL,
        NULL
    ),
    -- 已拒绝的退款
    (
        'REFUND202512150005',
        'ORDER202512150005',
        5,
        388.00,
        0.00,
        0.00,
        '不想去了',
        1,
        4,
        '2025-12-15 15:00:00',
        '2025-12-15 15:10:00',
        NULL,
        '已超过退款时限，无法退款'
    ),
    -- 退款中（已审核，等待退款）
    (
        'REFUND202512150006',
        'ORDER202512150011',
        1,
        158.00,
        0.00,
        158.00,
        '景区临时关闭',
        1,
        2,
        '2025-12-15 16:00:00',
        '2025-12-15 16:05:00',
        NULL,
        NULL
    ),
    -- 部分退款
    (
        'REFUND202512150007',
        'ORDER202512150012',
        2,
        200.00,
        10.00,
        190.00,
        '只退一张票',
        2,
        3,
        '2025-12-15 13:00:00',
        '2025-12-15 13:05:00',
        '2025-12-15 13:15:00',
        NULL
    );
-- 更新订单表的退款状态
UPDATE `orders`
SET `refund_status` = 2
WHERE `order_no` IN (
        'ORDER202512150001',
        'ORDER202512150002',
        'ORDER202512150012'
    );
UPDATE `orders`
SET `refund_status` = 1
WHERE `order_no` IN (
        'ORDER202512150003',
        'ORDER202512150004',
        'ORDER202512150011'
    );
UPDATE `orders`
SET `refund_status` = 3
WHERE `order_no` = 'ORDER202512150005';
-- 验证数据
SELECT COUNT(*) as payment_count
FROM `payments`;
SELECT COUNT(*) as refund_count
FROM `refund_orders`;