-- ============================================================
-- 添加支付流水和退款申请测试数据
-- 创建时间: 2025-12-16
-- 表名修正: 使用order_refunds（与DDL.sql一致）
-- ============================================================
-- 先插入测试用户数据（确保外键约束满足）
INSERT IGNORE INTO `users` (
        `id`,
        `phone`,
        `password`,
        `nickname`,
        `avatar`,
        `status`,
        `register_source`,
        `register_time`,
        `last_login_time`
    )
VALUES (
        1,
        '13800000001',
        '$2a$10$TestPassword1',
        '测试用户1',
        NULL,
        1,
        'miniapp',
        NOW(),
        NOW()
    ),
    (
        2,
        '13800000002',
        '$2a$10$TestPassword2',
        '测试用户2',
        NULL,
        1,
        'miniapp',
        NOW(),
        NOW()
    ),
    (
        3,
        '13800000003',
        '$2a$10$TestPassword3',
        '测试用户3',
        NULL,
        1,
        'miniapp',
        NOW(),
        NOW()
    ),
    (
        4,
        '13800000004',
        '$2a$10$TestPassword4',
        '测试用户4',
        NULL,
        1,
        'miniapp',
        NOW(),
        NOW()
    ),
    (
        5,
        '13800000005',
        '$2a$10$TestPassword5',
        '测试用户5',
        NULL,
        1,
        'miniapp',
        NOW(),
        NOW()
    );
-- 插入支付流水测试数据
INSERT INTO `payments` (
        `payment_no`,
        `order_no`,
        `payment_type`,
        `payment_channel`,
        `payment_amount`,
        `status`,
        `third_party_no`,
        `payer_id`,
        `payment_time`,
        `callback_time`,
        `create_time`
    )
VALUES -- 成功的支付记录
    (
        'PAY202512160001',
        'ORDER202512160001',
        'wechat',
        'miniapp',
        298.00,
        1,
        'WX20251216001',
        'oABC123',
        '2025-12-16 09:30:00',
        '2025-12-16 09:30:05',
        '2025-12-16 09:28:00'
    ),
    (
        'PAY202512160002',
        'ORDER202512160002',
        'alipay',
        'app',
        568.00,
        1,
        'ALI20251216001',
        '2088123456789',
        '2025-12-16 10:15:00',
        '2025-12-16 10:15:03',
        '2025-12-16 10:12:00'
    ),
    (
        'PAY202512160003',
        'ORDER202512160003',
        'wechat',
        'h5',
        128.00,
        1,
        'WX20251216002',
        'oXYZ789',
        '2025-12-16 11:20:00',
        '2025-12-16 11:20:04',
        '2025-12-16 11:18:00'
    ),
    (
        'PAY202512160004',
        'ORDER202512160004',
        'wechat',
        'miniapp',
        99.00,
        1,
        'WX20251216003',
        'oDEF456',
        '2025-12-16 13:45:00',
        '2025-12-16 13:45:06',
        '2025-12-16 13:42:00'
    ),
    (
        'PAY202512160005',
        'ORDER202512160005',
        'alipay',
        'h5',
        388.00,
        1,
        'ALI20251216002',
        '2088987654321',
        '2025-12-16 14:30:00',
        '2025-12-16 14:30:02',
        '2025-12-16 14:28:00'
    ),
    -- 待支付记录
    (
        'PAY202512160006',
        'ORDER202512160006',
        'wechat',
        'miniapp',
        158.00,
        0,
        NULL,
        NULL,
        NULL,
        NULL,
        '2025-12-16 15:20:00'
    ),
    (
        'PAY202512160007',
        'ORDER202512160007',
        'alipay',
        'app',
        268.00,
        0,
        NULL,
        NULL,
        NULL,
        NULL,
        '2025-12-16 15:35:00'
    ),
    -- 失败的支付记录
    (
        'PAY202512160008',
        'ORDER202512160008',
        'wechat',
        'h5',
        199.00,
        2,
        'WX20251216004',
        'oGHI789',
        NULL,
        '2025-12-16 16:10:05',
        '2025-12-16 16:08:00'
    ),
    -- 已关闭的支付记录
    (
        'PAY202512160009',
        'ORDER202512160009',
        'wechat',
        'miniapp',
        328.00,
        3,
        NULL,
        NULL,
        NULL,
        NULL,
        '2025-12-15 18:00:00'
    ),
    -- 处理中的支付记录
    (
        'PAY202512160010',
        'ORDER202512160010',
        'alipay',
        'app',
        458.00,
        4,
        'ALI20251216003',
        '2088111222333',
        NULL,
        NULL,
        '2025-12-16 16:50:00'
    );
-- 插入退款申请测试数据（使用order_refunds表）
INSERT INTO `order_refunds` (
        `refund_no`,
        `order_no`,
        `user_id`,
        `refund_type`,
        `refund_amount`,
        `refund_fee`,
        `actual_refund`,
        `refund_reason`,
        `status`,
        `created_at`,
        `updated_at`
    )
VALUES -- 已完成的退款（状态4=成功）
    (
        'REFUND202512160001',
        'ORDER202512160001',
        1,
        1,
        298.00,
        0.00,
        298.00,
        '行程取消，无法前往',
        4,
        '2025-12-16 10:00:00',
        '2025-12-16 10:10:00'
    ),
    (
        'REFUND202512160002',
        'ORDER202512160002',
        2,
        1,
        568.00,
        28.40,
        539.60,
        '临时有事，无法游览',
        4,
        '2025-12-16 11:30:00',
        '2025-12-16 11:40:00'
    ),
    -- 待审核的退款（状态0=待审核）
    (
        'REFUND202512160003',
        'ORDER202512160003',
        3,
        1,
        128.00,
        0.00,
        128.00,
        '订单重复下单',
        0,
        '2025-12-16 12:00:00',
        '2025-12-16 12:00:00'
    ),
    (
        'REFUND202512160004',
        'ORDER202512160004',
        4,
        1,
        99.00,
        4.95,
        94.05,
        '天气原因，不适宜出行',
        0,
        '2025-12-16 14:00:00',
        '2025-12-16 14:00:00'
    ),
    -- 审核拒绝的退款（状态2=审核拒绝）
    (
        'REFUND202512160005',
        'ORDER202512160005',
        5,
        1,
        388.00,
        0.00,
        0.00,
        '不想去了',
        2,
        '2025-12-16 15:00:00',
        '2025-12-16 15:10:00'
    ),
    -- 退款中（状态3=退款中，审核通过但支付渠道退款处理中）
    (
        'REFUND202512160006',
        'ORDER202512160006',
        1,
        1,
        158.00,
        0.00,
        158.00,
        '景区临时关闭',
        3,
        '2025-12-16 16:00:00',
        '2025-12-16 16:05:00'
    ),
    -- 部分退款（状态4=成功）
    (
        'REFUND202512160007',
        'ORDER202512160007',
        2,
        2,
        200.00,
        10.00,
        190.00,
        '只退一张票',
        4,
        '2025-12-16 13:00:00',
        '2025-12-16 13:15:00'
    );
-- 验证数据
SELECT COUNT(*) as payment_count
FROM `payments`
WHERE payment_no LIKE 'PAY20251216%';
SELECT COUNT(*) as refund_count
FROM `order_refunds`
WHERE refund_no LIKE 'REFUND20251216%';
-- 状态说明：
-- order_refunds.status: 0-待审核, 1-审核通过, 2-审核拒绝, 3-退款中, 4-成功, 5-失败
-- order_refunds.refund_type: 1-全额退款, 2-部分退款