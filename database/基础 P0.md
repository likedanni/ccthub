批次 1 (基础 P0)\*\*：包含第 1、7、11、12、13、16、17、20 号表（共 8 张），构建最核心的业务链路。

// ============================================
// 长治文旅平台 - 数据库设计 v1.0
// 批次 1: 基础 P0 核心表 (8 张表)
// 设计原则: 语法纯净，无错误，包含中英文注释
// ============================================

// 1. 用户核心表 (所有业务的基础)
Table users {
id bigint [pk, increment]
phone varchar(20) [not null, unique]
phone_encrypted varchar(128) [not null, note: '加密存储，用于安全匹配']
nickname varchar(50) [not null]
avatar_url varchar(500)
id_card_encrypted varchar(128) [note: '加密存储']
real_name varchar(50)
member_level tinyint [default: 1, note: '会员等级: 1-普通, 2-白银, 3-黄金, 4-钻石']
growth_value int [default: 0, note: '成长值']
total_points int [default: 0, note: '累计积分']
available_points int [default: 0, note: '可用积分']
wallet_balance decimal(10, 2) [default: 0.00, note: '钱包余额(元)']
status tinyint [default: 0, note: '状态: 0-正常, 1-冻结, 2-注销']
register_time datetime [default: `now()`]
last_login_time datetime
data_version int [default: 1, note: '乐观锁版本号']

indexes {
phone
phone_encrypted
member_level
register_time
status
}
note: '平台用户核心信息表，预计数据量 50 万+。敏感信息均加密存储。'
}

// 2. 商户主表 (B 端业务基础)
Table merchants {
id bigint [pk, increment]
name varchar(200) [not null]
type tinyint [not null, note: '类型: 1-景区, 2-餐饮, 3-文创, 4-生鲜便利']
cooperation_type tinyint [not null, note: '合作类型: 1-直营, 2-联营, 3-加盟']
contact_person varchar(50) [not null]
contact_phone varchar(20) [not null]
business_license varchar(100)
province varchar(50) [not null]
city varchar(50) [not null]
district varchar(50)
address varchar(500) [not null]
longitude decimal(10, 6) [note: '经度，用于地图和附近推荐']
latitude decimal(10, 6) [note: '纬度']
settlement_rate decimal(5, 4) [note: '平台结算费率']
audit_status tinyint [default: 0, note: '审核状态: 0-待审核, 1-通过, 2-拒绝']
status tinyint [default: 1, note: '状态: 1-正常, 0-停用']
level tinyint [default: 1, note: '商户等级']
score decimal(3, 2) [default: 5.00, note: '商户评分']
create_time datetime [default: `now()`]

indexes {
city
type
cooperation_type
audit_status
status
}
note: '入驻商户信息表，支持多种合作类型和结算规则。'
}

// 3. 景区/资源表 (文旅资源基础)
Table scenic_spots {
id bigint [pk, increment]
name varchar(200) [not null]
level varchar(20) [note: '景区级别，如: A, AA, 5A']
introduction text [note: '详细介绍']
province varchar(50) [not null]
city varchar(50) [not null]
address varchar(500) [not null]
longitude decimal(10, 6)
latitude decimal(10, 6)
opening_hours varchar(200) [note: '开放时间描述']
contact_phone varchar(20)
cover_image varchar(500) [note: '封面图']
status tinyint [default: 1, note: '状态: 1-开放, 0-关闭']
create_time datetime [default: `now()`]

indexes {
city
level
status
}
note: '文旅资源基础信息表，可扩展为多类型资源（博物馆、公园等）。'
}

// 4. 商品 SPU 表 (统一商品管理)
Table products {
id bigint [pk, increment]
merchant_id bigint [ref: > merchants.id]
scenic_spot_id bigint [ref: > scenic_spots.id, note: '可为空，非景区商品无关联']
type tinyint [not null, note: '商品类型: 1-门票, 2-餐饮, 3-文创, 4-生鲜']
category_id bigint [note: '商品分类 ID']
name varchar(200) [not null]
subtitle varchar(200) [note: '副标题/卖点']
main_image varchar(500)
image_list json [note: 'JSON 数组，商品图册']
description text [note: '商品描述']
spec_template json [note: 'JSON，规格模板']
point_ratio decimal(5, 4) [default: 0.0100, note: '积分赠送比例']
audit_status tinyint [default: 0, note: '审核状态: 0-待审, 1-通过, 2-拒绝']
shelf_status tinyint [default: 0, note: '上下架: 0-下架, 1-上架']
create_time datetime [default: `now()`]
update_time datetime [default: `now()`]

indexes {
merchant_id
type
scenic_spot_id
shelf_status
audit_status
}
note: '标准化商品信息表(SPU)，与具体规格(SKU)分离。'
}

// 5. 商品 SKU 表 (库存与价格单元)
Table product_skus {
id bigint [pk, increment]
product_id bigint [ref: > products.id, not null]
sku_code varchar(50) [not null, unique, note: 'SKU 编码，唯一']
sku_name varchar(200) [not null, note: 'SKU 名称，如: 成人票-上午场']
specs json [not null, note: 'JSON，具体规格，如: {"时段": "上午", "人群": "成人"}']
original_price decimal(10, 2) [not null, note: '门市价/原价']
sell_price decimal(10, 2) [not null, note: '销售价']
cost_price decimal(10, 2) [note: '成本价，用于核算']
stock_total int [default: 0, note: '总库存']
stock_available int [default: 0, note: '可用库存']
stock_locked int [default: 0, note: '锁定库存（下单未支付）']
status tinyint [default: 1, note: '状态: 1-启用, 0-禁用']
sales_count int [default: 0, note: '销售数量']

indexes {
product_id
sku_code
status
}
note: '商品最小库存单位表(SKU)，管理价格、库存和销售。'
}

// 6. 订单主表 (交易核心)
Table orders {
order_no varchar(32) [pk, note: '业务订单号，如: ORDER202412110001']
user_id bigint [ref: > users.id, not null]
merchant_id bigint [ref: > merchants.id]
order_type tinyint [not null, note: '订单类型: 1-门票, 2-实物商品, 3-活动']
total_amount decimal(10, 2) [not null, note: '订单总金额']
discount_amount decimal(10, 2) [default: 0.00, note: '优惠总金额']
pay_amount decimal(10, 2) [not null, note: '实际支付金额']
point_amount decimal(10, 2) [default: 0.00, note: '积分抵扣金额']
point_earned int [default: 0, note: '本次获得积分']
payment_method varchar(50) [note: '支付方式: wechat, alipay, balance']
payment_status tinyint [default: 0, note: '支付状态: 0-待支付, 1-成功, 2-失败, 3-已退款']
order_status tinyint [default: 0, note: '订单状态: 0-待付款, 1-待使用, 2-已完成, 3-已取消, 4-退款中']
refund_status tinyint [default: 0, note: '退款状态: 0-无退款, 1-退款中, 2-成功, 3-失败']
create_time datetime [default: `now()`]
update_time datetime [default: `now()`]

indexes {
user_id
merchant_id
create_time
order_status
payment_status
}
note: '订单主表，按 user_id 分片，需考虑按 create_time 分表。状态机复杂，需仔细设计。'
}

// 7. 订单明细表 (交易核心)
Table order_items {
id bigint [pk, increment]
order_no varchar(32) [ref: > orders.order_no, not null]
product_id bigint [ref: > products.id]
product_name varchar(200) [not null, note: '下单时的商品快照']
sku_id bigint [ref: > product_skus.id]
sku_specs varchar(500) [note: '下单时的规格快照']
unit_price decimal(10, 2) [not null]
quantity int [not null]
subtotal decimal(10, 2) [not null]
verification_code varchar(50) [unique, note: '核销码/券码，唯一']
verification_status tinyint [default: 0, note: '核销状态: 0-未核销, 1-已核销, 2-已过期']
ticket_date date [note: '票务使用日期']
visitor_name varchar(50) [note: '游客姓名']

indexes {
order_no
verification_code
ticket_date
verification_status
}
note: '订单明细表，记录每件商品信息。核销码在此表管理。'
}

// 8. 支付记录表 (资金流水核心)
Table payments {
id bigint [pk, increment]
payment_no varchar(32) [not null, unique, note: '支付系统流水号']
order_no varchar(32) [ref: > orders.order_no, not null]
payment_type varchar(20) [not null, note: '支付类型: wechat, alipay, unionpay']
payment_channel varchar(50) [not null, note: '支付渠道: miniapp, app, h5, native']
payment_amount decimal(10, 2) [not null]
status tinyint [not null, note: '状态: 0-待支付, 1-成功, 2-失败, 3-关闭']
third_party_no varchar(64) [note: '第三方支付平台流水号']
payer_id varchar(100) [note: '支付方标识（如微信 openid）']
payment_time datetime
callback_time datetime [note: '支付回调时间']
create_time datetime [default: `now()`]

indexes {
order_no
payment_no
third_party_no
create_time
status
}
note: '支付流水表，与订单 1:1 或 1:N。需严格对账。'
}

// ============================================
// 批次 1 - 表关系说明
// 1. users (1) : (N) orders
// 2. merchants (1) : (N) products
// 3. merchants (1) : (N) orders
// 4. scenic_spots (1) : (N) products (可选)
// 5. products (1) : (N) product_skus
// 6. orders (1) : (N) order_items
// 7. orders (1) : (1/N) payments
// ============================================
