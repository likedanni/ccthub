批次 2 (扩展 P0)\*\*：包含第 2、8、14、15 号表（共 4 张），扩展用户、商户和票务细节。

// ============================================
// 长治文旅平台 - 数据库设计 v1.0
// 批次 2: 扩展 P0 核心表 (4 张表)
// 注意：表名与批次 1 的脚本保持一致，可直接合并
// ============================================

// 9. 用户收货地址表 (电商与邮寄基础)
Table user_addresses {
id bigint [pk, increment]
user_id bigint [ref: > users.id, not null]
recipient_name varchar(50) [not null, note: '收货人姓名']
recipient_phone varchar(20) [not null]
province varchar(50) [not null]
city varchar(50) [not null]
district varchar(50) [not null]
detail_address varchar(200) [not null]
postal_code varchar(10)
is_default boolean [default: false, note: '是否默认地址']
create_time datetime [default: `now()`]
update_time datetime [default: `now()`]

indexes {
user_id
(user_id, is_default)
}
note: '用户收货地址表，用于实物商品（文创、生鲜）邮寄。'
}

// 10. 商户员工表 (B 端权限基础)
Table merchant_employees {
id bigint [pk, increment]
merchant_id bigint [ref: > merchants.id, not null]
user_id bigint [ref: > users.id, not null, note: '关联平台用户账号']
employee_name varchar(50) [not null]
employee_phone varchar(20) [not null]
role tinyint [not null, note: '角色: 1-管理员, 2-运营员, 3-核销员']
permissions json [note: 'JSON 配置，细粒度权限']
status tinyint [default: 1, note: '状态: 1-正常, 0-停用']
create_time datetime [default: `now()`]

indexes {
merchant_id
user_id
(merchant_id, user_id) [unique, note: '同一商户下，一个用户只能绑定一次']
role
}
note: '商户员工绑定与权限表，支持员工使用小程序进行核销、管理。'
}

// 11. 票种模板表 (票务业务核心)
Table tickets {
id bigint [pk, increment]
scenic_spot_id bigint [ref: > scenic_spots.id, not null]
name varchar(200) [not null]
type tinyint [not null, note: '票种类型: 1-单票, 2-联票, 3-套票']
description text
validity_type tinyint [not null, note: '有效期类型: 1-指定日期, 2-有效天数']
valid_days int [note: '有效期天数（当 validity_type=2 时使用）']
advance_days int [default: 7, note: '可提前预订天数']
refund_policy json [not null, note: 'JSON，退款规则配置']
change_policy json [not null, note: 'JSON，改签规则配置']
limit_per_user int [default: 5, note: '每用户限购数量']
limit_per_day int [note: '每日限购数量']
require_real_name boolean [default: true]
require_id_card boolean [default: true]
verification_mode tinyint [default: 1, note: '核验方式: 1-二维码, 2-人脸, 3-身份证']
status tinyint [default: 1, note: '状态: 1-上架, 0-下架']
create_time datetime [default: `now()`]

indexes {
scenic_spot_id
type
status
}
note: '票种模板表，定义某景区的一种门票规则。实际销售的是其下某一天的具体库存（ticket_prices）。'
}

// 12. 票价日历表 (动态库存与定价)
Table ticket_prices {
id bigint [pk, increment]
ticket_id bigint [ref: > tickets.id, not null]
price_date date [not null, note: '适用日期']
price_type tinyint [not null, note: '价格类型: 1-成人票, 2-学生票, 3-儿童票, 4-老年票']
original_price decimal(10, 2) [not null, note: '门市价']
sell_price decimal(10, 2) [not null, note: '销售价']
inventory_total int [not null, note: '总库存']
inventory_available int [not null, note: '可用库存']
is_active boolean [default: true, note: '该日期价格是否生效']
create_time datetime [default: `now()`]
update_time datetime [default: `now()`]

indexes {
ticket_id
price_date
(ticket_id, price_date, price_type) [unique, note: '同一票种、同一日期、同一价格类型唯一']
is_active
}
note: '票价与库存日历表。支持每天不同的价格和独立的库存管理，是实际销售的单位。'
}

// ============================================
// 批次 2 - 新增关系说明
// 1. users (1) : (N) user_addresses
// 2. merchants (1) : (N) merchant_employees
// 3. users (1) : (1) merchant_employees (通过 user_id 关联)
// 4. scenic_spots (1) : (N) tickets
// 5. tickets (1) : (N) ticket_prices (按日期)
// ============================================
